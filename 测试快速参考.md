# 🚀 XunDoc 自动化测试 - 快速参考

## 一键运行测试

### 方法1️⃣: 使用Shell脚本（最简单）

```bash
# 进入项目目录
cd /Users/plutoguo/Desktop/XunDoc

# 快速测试（推荐，仅测试核心功能，约1-2分钟）
./run_tests.sh --quick

# 完整UI测试（约3-5分钟）
./run_tests.sh --ui

# 所有测试 + 生成报告
./run_tests.sh --all --report

# 清理后测试
./run_tests.sh --ui --clean

# 在特定设备上测试
./run_tests.sh --ui --device "iPhone 14"
```

### 方法2️⃣: 使用Fastlane（功能最强大）

```bash
# 首次使用需要安装
sudo gem install fastlane

# 快速测试
fastlane quick_test

# UI自动化测试
fastlane ui_test

# 完整测试套件（多设备）
fastlane full_test

# 夜间回归测试
fastlane nightly
```

### 方法3️⃣: 使用Xcode（最直观）

1. 打开项目：`open XunDoc.xcodeproj`
2. 按 `Cmd + 6` 打开测试导航器
3. 找到 `XunDocUITests` > `XunDocAutomatedTests`
4. 点击 ▶️ 运行测试
5. 或按 `Cmd + U` 运行所有测试

---

## 📊 测试用例清单

| # | 测试名称 | 耗时 | 优先级 |
|---|---------|------|-------|
| 1 | 应用启动 | ~3秒 | P0 ⭐⭐⭐ |
| 2 | 底部导航 | ~5秒 | P0 ⭐⭐⭐ |
| 3 | 创建记录 | ~8秒 | P0 ⭐⭐⭐ |
| 4 | 搜索功能 | ~3秒 | P1 ⭐⭐ |
| 5 | 查看详情 | ~4秒 | P1 ⭐⭐ |
| 6 | 添加用药 | ~10秒 | P0 ⭐⭐⭐ |
| 7 | 完成用药 | ~3秒 | P1 ⭐⭐ |
| 8 | 个人页面 | ~5秒 | P1 ⭐⭐ |
| 9 | 切换性能 | ~15秒 | P1 ⭐⭐ |
| 10 | 稳定性测试 | ~10秒 | P1 ⭐⭐ |

**总计**: 约60-90秒（快速测试：约15秒）

---

## 🎯 常用命令速查

### 📱 运行测试

```bash
# 快速测试（核心功能）
./run_tests.sh -q

# UI测试
./run_tests.sh -u

# 完整测试
./run_tests.sh -a

# 带报告
./run_tests.sh -u -r

# 清理 + 测试
./run_tests.sh -u -c
```

### 🔧 Xcode命令行

```bash
# 运行UI测试
xcodebuild test \
  -project XunDoc.xcodeproj \
  -scheme XunDoc \
  -destination 'platform=iOS Simulator,name=iPhone 15 Pro,OS=17.0' \
  -only-testing:XunDocUITests

# 运行单个测试
xcodebuild test \
  -project XunDoc.xcodeproj \
  -scheme XunDoc \
  -destination 'platform=iOS Simulator,name=iPhone 15 Pro,OS=17.0' \
  -only-testing:XunDocUITests/XunDocAutomatedTests/test001_AppLaunch
```

### 📊 查看结果

```bash
# 查看最新测试结果
open ~/Library/Developer/Xcode/DerivedData/*/Logs/Test/*.xcresult

# 生成JSON报告
xcrun xcresulttool get --format json --path TestResults.xcresult
```

---

## 🐛 故障排除

### 问题1: 找不到元素
```swift
// 使用模糊匹配
let button = app.buttons.matching(
    NSPredicate(format: "label CONTAINS '登录'")
).firstMatch

// 打印所有元素
print(app.debugDescription)
```

### 问题2: 测试超时
```swift
// 增加等待时间
let exists = element.waitForExistence(timeout: 10)
```

### 问题3: 模拟器卡住
```bash
# 重置模拟器
xcrun simctl shutdown all
xcrun simctl erase all
```

### 问题4: 脚本权限错误
```bash
chmod +x run_tests.sh
```

---

## 📈 推荐测试频率

| 场景 | 测试类型 | 频率 |
|------|---------|------|
| 每次代码提交前 | 快速测试 | 必须 |
| 每日开发结束 | UI测试 | 建议 |
| 发布前 | 完整测试 | 必须 |
| 夜间自动化 | 回归测试 | 每晚 |

---

## 💡 最佳实践

1. **提交代码前**: 运行快速测试
   ```bash
   ./run_tests.sh --quick
   ```

2. **修改UI后**: 运行UI测试
   ```bash
   ./run_tests.sh --ui
   ```

3. **发布版本前**: 运行完整测试
   ```bash
   fastlane full_test
   ```

4. **修复Bug后**: 运行相关测试用例
   ```bash
   # 在Xcode中单独运行对应的测试
   ```

---

## 📞 获取帮助

```bash
# 查看脚本帮助
./run_tests.sh --help

# 查看Fastlane帮助
fastlane --help

# 查看可用的lane
fastlane lanes
```

---

## 📁 文件结构

```
XunDoc/
├── run_tests.sh                    # 一键测试脚本 ⭐
├── XunDocUITests/
│   └── XunDocAutomatedTests.swift  # 测试代码 ⭐
├── fastlane/
│   └── Fastfile                    # Fastlane配置 ⭐
├── 自动化测试使用指南.md            # 详细文档
└── 测试快速参考.md                 # 本文档
```

---

## 🎓 学习资源

- **Apple官方文档**: [XCTest Framework](https://developer.apple.com/documentation/xctest)
- **Fastlane文档**: [docs.fastlane.tools](https://docs.fastlane.tools)
- **视频教程**: 搜索 "iOS UI Testing XCUITest"

---

**快速开始**:
```bash
cd /Users/plutoguo/Desktop/XunDoc
./run_tests.sh --quick
```

**完整测试**:
```bash
fastlane full_test
```

祝测试顺利！🚀



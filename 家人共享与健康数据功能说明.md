# 家人共享与健康数据功能说明

## 功能概述

本次更新包含两大核心功能：

### 1. 家人共享功能
- 通过邀请码邀请家人加入健康圈
- 家人之间可以互相查看健康数据
- 支持双向数据共享

### 2. 健康数据管理（慢病管理）
- 表格化健康数据录入
- 支持多种健康指标（血压、血糖、心率、体重等）
- 定期提醒功能（每天/每周/每月）
- 数据历史记录查看

---

## 使用指南

### 一、家人共享功能

#### 1.1 生成邀请码（邀请家人）

1. 在首页点击右上角的 **人物图标** 按钮
2. 进入"家人共享"界面
3. 点击 **"生成邀请码"** 按钮
4. 系统会生成一个6位邀请码（有效期7天）
5. 点击 **"复制邀请码"** 分享给家人

**示例流程：**
```
首页 → 点击人物图标 → 生成邀请码 → 分享给家人
```

#### 1.2 使用邀请码（加入家庭）

1. 在首页点击右上角的 **人物图标** 按钮
2. 进入"家人共享"界面
3. 点击底部的 **"使用邀请码加入"** 按钮
4. 输入家人分享的6位邀请码
5. 点击 **"加入家庭"** 按钮

**示例流程：**
```
首页 → 点击人物图标 → 使用邀请码加入 → 输入6位码 → 加入成功
```

#### 1.3 管理家庭成员

在"家人共享"界面可以：
- 查看已连接的家庭成员
- 查看连接日期
- 移除不需要的连接（左滑删除）

---

### 二、健康数据管理（慢病管理）

#### 2.1 添加健康数据

**方式一：通过首页快速添加**
1. 进入"慢病管理"标签页
2. 点击右上角的 **+** 按钮
3. 选择数据类型（血压、血糖等）
4. 输入数值
5. 选择记录时间
6. 可选：添加备注
7. 点击 **"保存"**

**方式二：通过表格卡片快速添加**
1. 进入"慢病管理"标签页
2. 直接点击任意健康数据卡片（如"血压"卡片）
3. 自动选中对应类型，快速录入数据

**支持的健康数据类型：**
- 血压 (mmHg)
- 血糖 (mmol/L)
- 心率 (次/分)
- 体重 (kg)
- 体温 (°C)
- 血氧 (%)
- 糖化血红蛋白 (%)

#### 2.2 查看健康数据

**健康数据概览：**
- 在慢病管理页面顶部，可以看到所有健康指标的最新数据
- 显示最后一次记录的数值和时间
- 点击卡片可快速添加该类型数据

**历史记录：**
- 向下滚动可查看按类型分组的历史记录
- 点击类型标题展开/收起详细记录
- 每种类型默认显示最近5条记录

**首页显示：**
- 首页"健康概览"显示最新的血压、血糖、心率数据
- 首页"最近记录"显示最近3条健康数据记录

#### 2.3 设置健康数据提醒

1. 进入"慢病管理"标签页
2. 点击 **"管理提醒"** 按钮
3. 点击右上角的 **+** 按钮添加新提醒
4. 选择数据类型（如血压）
5. 选择提醒频率：
   - **每天**：每天在指定时间提醒
   - **每周**：每周在指定时间提醒
   - **每月**：每月在指定时间提醒
6. 设置提醒时间
7. 点击 **"保存"**

**管理提醒：**
- 使用开关快速启用/禁用提醒
- 左滑删除不需要的提醒
- 可以为同一类型数据设置多个提醒

#### 2.4 删除健康数据

1. 在历史记录中找到要删除的数据
2. 点击右侧的 **...** 按钮
3. 选择 **"删除"**
4. 确认删除

---

## 功能特点

### ✨ 家人共享
- ✅ 简单的邀请码机制，无需复杂设置
- ✅ 邀请码7天有效期，保证安全性
- ✅ 双向数据共享，家人之间互相关心
- ✅ 支持多个家庭成员连接

### 📊 健康数据管理
- ✅ 表格化数据展示，一目了然
- ✅ 支持7种常用健康指标
- ✅ 快速录入，点击卡片即可添加
- ✅ 智能提醒，不会错过测量时间
- ✅ 完整的历史记录，追踪健康趋势
- ✅ 数据与家庭成员关联，多人管理

### 🔔 智能提醒
- ✅ 每天/每周/每月多种频率选择
- ✅ 自定义提醒时间
- ✅ 本地通知，无需网络
- ✅ 可随时启用/禁用

---

## 数据存储说明

### 本地存储
- 所有健康数据存储在设备本地
- 使用UserDefaults进行持久化
- 数据与家庭成员ID关联

### 家人共享机制
- 当前版本采用邀请码机制
- 每个设备有唯一的用户ID
- 家庭连接信息本地存储

### 数据安全
- 数据仅存储在本地设备
- 邀请码有效期限制（7天）
- 可随时移除家庭连接

---

## 注意事项

1. **首次使用**：
   - 建议先在"首页"添加家庭成员
   - 然后在"慢病管理"中为成员添加健康数据

2. **提醒功能**：
   - 首次使用需要授权通知权限
   - 在系统设置中确保App通知权限已开启

3. **邀请码**：
   - 邀请码有效期为7天
   - 每个邀请码只能使用一次
   - 可以生成多个邀请码

4. **数据管理**：
   - 删除家庭成员不会删除其健康数据
   - 删除健康数据操作不可恢复
   - 建议定期备份重要数据

---

## 常见问题

**Q: 邀请码过期了怎么办？**
A: 重新生成一个新的邀请码即可。

**Q: 可以邀请多少个家人？**
A: 没有数量限制，可以邀请任意数量的家人。

**Q: 健康数据会上传到云端吗？**
A: 不会，所有数据都存储在设备本地。

**Q: 如何修改已录入的健康数据？**
A: 当前版本暂不支持修改，可以删除后重新添加。

**Q: 提醒功能不工作怎么办？**
A: 请检查：
   1. 系统设置中App通知权限是否开启
   2. 提醒开关是否开启
   3. 提醒时间设置是否正确

**Q: 可以看到家人的历史数据吗？**
A: 可以，在首页选择对应的家庭成员，然后进入慢病管理查看。

---

## 更新日志

### 版本 2.0
- ✨ 新增家人共享功能
- ✨ 重构慢病管理为健康数据录入界面
- ✨ 新增健康数据提醒功能
- ✨ 首页数据改为动态显示
- 🐛 移除所有静态模拟数据
- 💡 优化用户体验

---

## 技术说明

### 核心组件
- `FamilyShareManager`: 家人共享管理器
- `FamilyManagementView`: 家人管理界面
- `ChronicDiseaseView`: 健康数据管理界面
- `HealthDataEntry`: 健康数据模型
- `HealthDataReminder`: 健康提醒模型

### 数据模型
```swift
// 健康数据条目
struct HealthDataEntry {
    let id: UUID
    let memberId: UUID
    let type: HealthDataType
    let value: String
    let date: Date
    let notes: String?
}

// 健康数据提醒
struct HealthDataReminder {
    let id: UUID
    let memberId: UUID
    let dataType: HealthDataType
    let frequency: ReminderFrequency
    let time: Date
    var isEnabled: Bool
}

// 家庭连接
struct FamilyConnection {
    let id: UUID
    let userId: UUID
    let connectedUserId: UUID
    let connectedUserName: String
    let connectionDate: Date
    var canViewHealthData: Bool
}
```

---

## 反馈与支持

如有任何问题或建议，欢迎反馈！


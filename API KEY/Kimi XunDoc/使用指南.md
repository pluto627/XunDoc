# Kimi API 使用指南

## 您的API信息
- **API Key**: `sk-wc9tcOA0q2ShfOjKZ91YStbbyyoMGpiegf6zq54i9kpaQtke`
- **Base URL**: `https://api.moonshot.cn/v1`
- **推荐模型**: `kimi-k2-0905-preview`

## 快速开始

### 1. 安装依赖
```bash
pip install --upgrade 'openai>=1.0'
```

### 2. 基础调用示例
```python
from openai import OpenAI

client = OpenAI(
    api_key="sk-wc9tcOA0q2ShfOjKZ91YStbbyyoMGpiegf6zq54i9kpaQtke",
    base_url="https://api.moonshot.cn/v1",
)

completion = client.chat.completions.create(
    model="kimi-k2-0905-preview",
    messages=[
        {"role": "system", "content": "你是 Kimi，由 Moonshot AI 提供的人工智能助手，你更擅长中文和英文的对话。你会为用户提供安全，有帮助，准确的回答。同时，你会拒绝一切涉及恐怖主义，种族歧视，黄色暴力等问题的回答。Moonshot AI 为专有名词，不可翻译成其他语言。"},
        {"role": "user", "content": "你好，我叫李雷，1+1等于多少？"}
    ],
    temperature=0.6,
)

print(completion.choices[0].message.content)
```

## 高级功能

### 1. JSON 模式 - 结构化输出
```python
completion = client.chat.completions.create(
    model="kimi-k2-0905-preview",
    messages=[
        {"role": "system", "content": "请以JSON格式回答，包含text、image、url字段"},
        {"role": "user", "content": "介绍一下Kimi的功能"}
    ],
    response_format={"type": "json_object"},
    temperature=0.6,
)
```

### 2. Partial 模式 - 引导式生成
```python
completion = client.chat.completions.create(
    model="kimi-k2-0905-preview",
    messages=[
        {"role": "system", "content": "你是客服助手"},
        {"role": "user", "content": "我想咨询API使用问题"},
        {
            "partial": True,
            "role": "assistant", 
            "content": "尊敬的用户您好，"
        }
    ],
    temperature=0.6,
)

# 需要手动拼接前缀
full_response = "尊敬的用户您好，" + completion.choices[0].message.content
```

### 3. 角色扮演模式
```python
completion = client.chat.completions.create(
    model="kimi-k2-0905-preview",
    messages=[
        {
            "role": "system",
            "content": "你扮演一个专业的技术顾问，具有丰富的API开发经验..."
        },
        {"role": "user", "content": "如何优化API调用性能？"},
        {
            "partial": True,
            "role": "assistant",
            "name": "技术顾问",
            "content": ""
        }
    ],
    temperature=0.6,
)
```

### 4. 文件问答功能
```python
from pathlib import Path

# 上传文件
file_object = client.files.create(file=Path("your_file.txt"), purpose="file-extract")

# 获取文件内容
file_content = client.files.content(file_id=file_object.id).text

# 基于文件内容问答
completion = client.chat.completions.create(
    model="kimi-k2-0905-preview",
    messages=[
        {"role": "system", "content": "你是文档分析助手"},
        {"role": "system", "content": file_content},
        {"role": "user", "content": "请总结这个文档的主要内容"}
    ],
    temperature=0.6,
)

# 清理文件
client.files.delete(file_id=file_object.id)
```

### 5. 视觉模型使用
```python
import base64

# 读取图片并编码
with open("image.png", "rb") as f:
    image_data = f.read()

image_url = f"data:image/png;base64,{base64.b64encode(image_data).decode('utf-8')}"

completion = client.chat.completions.create(
    model="moonshot-v1-8k-vision-preview",  # 使用视觉模型
    messages=[
        {"role": "system", "content": "你是 Kimi。"},
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": image_url}
                },
                {
                    "type": "text", 
                    "text": "请描述图片的内容。"
                }
            ]
        }
    ]
)
```

## 模型选择

| 模型名称 | 上下文长度 | 适用场景 |
|---------|-----------|----------|
| `kimi-k2-0905-preview` | 200k+ | 通用对话、文档分析 |
| `moonshot-v1-8k-vision-preview` | 8k | 图像理解 |
| `moonshot-v1-32k-vision-preview` | 32k | 图像理解 |
| `moonshot-v1-128k-vision-preview` | 128k | 图像理解 |

## 最佳实践

1. **温度参数**: 一般设置为 0.6，创意性任务可适当提高
2. **系统提示词**: 明确角色定位和回答要求
3. **错误处理**: 添加 try-catch 处理网络异常
4. **文件管理**: 及时清理上传的文件避免超出限制
5. **成本控制**: 合理设置 max_tokens 避免过长输出

## 测试结果

✅ 基础对话功能正常  
✅ JSON模式输出正确  
✅ Partial模式引导成功  
✅ 角色扮演效果良好  
✅ 文件问答功能完整  

您的API Key已验证可用，可以开始正式开发了！

## 注意事项

- API Key请妥善保管，不要泄露给他人
- 注意API调用频率限制
- 定期检查余额和使用情况
- 遵循Moonshot AI的使用条款

---

*基于您提供的Support文档和API Key测试生成*



<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kimiå¾®è°ƒæ•°æ®ç”Ÿæˆå™¨ - Webç•Œé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .control-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid #f1f3f4;
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
        }

        .result-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .result-card .icon {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .stats-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .log-container {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            border: 2px solid #34495e;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px 0;
        }

        .log-entry.success { color: #2ecc71; }
        .log-entry.error { color: #e74c3c; }
        .log-entry.info { color: #3498db; }
        .log-entry.warning { color: #f39c12; }

        .data-preview {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-list {
            list-style: none;
            padding: 0;
        }

        .file-list li {
            background: #f8f9fa;
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-size {
            color: #6c757d;
            font-size: 0.9em;
        }

        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }

        .download-btn:hover {
            background: #218838;
        }

        .config-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .config-section h4 {
            color: #856404;
            margin-bottom: 15px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– Kimiå¾®è°ƒæ•°æ®ç”Ÿæˆå™¨</h1>
            <p>åŸºäºåŒ»å­¦æ•°æ®çš„æ™ºèƒ½å¾®è°ƒæ•°æ®é›†ç”Ÿæˆç³»ç»Ÿ</p>
        </div>

        <div class="control-panel">
            <h3>ğŸ¯ æ“ä½œæ§åˆ¶å°</h3>
            <button class="btn" id="loadDataBtn" onclick="loadMedicalData()">
                ğŸ“¥ åŠ è½½åŒ»å­¦æ•°æ®
            </button>
            <button class="btn" id="convertDataBtn" onclick="convertToAlpaca()" disabled>
                ğŸ”„ è½¬æ¢Alpacaæ ¼å¼
            </button>
            <button class="btn" id="generateQABtn" onclick="generateEnhancedQA()" disabled>
                ğŸ¤– ç”Ÿæˆå¢å¼ºQAå¯¹
            </button>
            <button class="btn" id="createDatasetBtn" onclick="createFinalDataset()" disabled>
                ğŸ“Š åˆ›å»ºæœ€ç»ˆæ•°æ®é›†
            </button>
            <button class="btn" id="downloadBtn" onclick="downloadResults()" disabled>
                ğŸ’¾ ä¸‹è½½ç»“æœ
            </button>
        </div>

        <div id="progressSection" class="hidden">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="progressText" class="status info">å‡†å¤‡å¼€å§‹...</div>
        </div>

        <div class="results-grid">
            <div class="result-card">
                <h3><span class="icon">ğŸ“Š</span>æ•°æ®ç»Ÿè®¡</h3>
                <div>æ€»æ ·æœ¬æ•°: <span class="stats-number" id="totalSamples">0</span></div>
                <div>è®­ç»ƒé›†: <span id="trainCount">0</span> æ¡</div>
                <div>éªŒè¯é›†: <span id="valCount">0</span> æ¡</div>
                <div>å¹³å‡è¾“å…¥é•¿åº¦: <span id="avgInputLen">0</span> å­—ç¬¦</div>
            </div>

            <div class="result-card">
                <h3><span class="icon">ğŸ“</span>ç”Ÿæˆæ–‡ä»¶</h3>
                <ul class="file-list" id="fileList">
                    <li>æš‚æ— æ–‡ä»¶ç”Ÿæˆ</li>
                </ul>
            </div>

            <div class="result-card">
                <h3><span class="icon">ğŸ¯</span>æ•°æ®æ¥æº</h3>
                <div id="sourcesChart">
                    <div>åŸå§‹åŒ»å­¦å¯¹è¯: <span id="originalCount">0</span></div>
                    <div>Kimiå¢å¼ºç”Ÿæˆ: <span id="enhancedCount">0</span></div>
                    <div>ä¸“ä¸šé¢†åŸŸé—®ç­”: <span id="domainCount">0</span></div>
                </div>
            </div>

            <div class="result-card">
                <h3><span class="icon">âš™ï¸</span>å¾®è°ƒé…ç½®</h3>
                <div class="config-section">
                    <h4>LLaMA-Factoryé…ç½®</h4>
                    <p>æ¨¡å‹: moonshot-v1-8k</p>
                    <p>å¾®è°ƒç±»å‹: LoRA</p>
                    <p>å­¦ä¹ ç‡: 5e-5</p>
                    <p>è®­ç»ƒè½®æ•°: 3</p>
                </div>
            </div>
        </div>

        <div class="log-container">
            <div id="logOutput">
                <div class="log-entry info">ğŸš€ ç³»ç»Ÿå·²å°±ç»ªï¼Œç‚¹å‡»"åŠ è½½åŒ»å­¦æ•°æ®"å¼€å§‹...</div>
            </div>
        </div>

        <div id="dataPreview" class="hidden">
            <h3>ğŸ“‹ æ•°æ®é¢„è§ˆ</h3>
            <div class="data-preview" id="previewContent"></div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let currentData = {
            originalData: [],
            alpacaData: [],
            enhancedData: [],
            domainData: [],
            finalDataset: [],
            stats: {}
        };

        let currentStep = 0;
        const totalSteps = 5;

        // æ—¥å¿—å‡½æ•°
        function addLog(message, type = 'info') {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            const icons = {
                'info': 'â„¹ï¸',
                'success': 'âœ…',
                'error': 'âŒ',
                'warning': 'âš ï¸'
            };
            
            logEntry.innerHTML = `[${timestamp}] ${icons[type]} ${message}`;
            logOutput.appendChild(logEntry);
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(step, message) {
            const progressSection = document.getElementById('progressSection');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressSection.classList.remove('hidden');
            const percentage = (step / totalSteps) * 100;
            progressFill.style.width = percentage + '%';
            progressText.innerHTML = `<div class="spinner"></div>${message} (${step}/${totalSteps})`;
            
            if (step === totalSteps) {
                progressText.className = 'status success';
                progressText.innerHTML = 'ğŸ‰ æ‰€æœ‰æ­¥éª¤å®Œæˆï¼';
            }
        }

        // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
        async function loadMedicalData() {
            addLog('å¼€å§‹åŠ è½½åŒ»å­¦æ•°æ®...', 'info');
            updateProgress(1, 'æ­£åœ¨åŠ è½½åŒ»å­¦æ•°æ®');
            
            // æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
            await sleep(1500);
            
            // æ¨¡æ‹ŸåŠ è½½çš„æ•°æ®
            currentData.originalData = generateMockMedicalData(20);
            
            addLog(`æˆåŠŸåŠ è½½ ${currentData.originalData.length} æ¡åŒ»å­¦å¯¹è¯æ•°æ®`, 'success');
            
            // å¯ç”¨ä¸‹ä¸€æ­¥æŒ‰é’®
            document.getElementById('convertDataBtn').disabled = false;
            updateStats();
        }

        // è½¬æ¢ä¸ºAlpacaæ ¼å¼
        async function convertToAlpaca() {
            addLog('å¼€å§‹è½¬æ¢ä¸ºAlpacaæ ¼å¼...', 'info');
            updateProgress(2, 'æ­£åœ¨è½¬æ¢æ•°æ®æ ¼å¼');
            
            await sleep(1000);
            
            // æ¨¡æ‹Ÿè½¬æ¢è¿‡ç¨‹
            currentData.alpacaData = currentData.originalData.map((item, index) => ({
                instruction: "è¯·åˆ†æåŒ»å­¦å¤šé€‰é¢˜å¹¶ç»™å‡ºæ­£ç¡®ç­”æ¡ˆå’Œè¯¦ç»†è§£é‡Šã€‚",
                input: item.question.substring(0, 500),
                output: item.answer,
                id: `medical_${index + 1}`,
                source: "jmed_chat_format"
            }));
            
            addLog(`æˆåŠŸè½¬æ¢ ${currentData.alpacaData.length} æ¡Alpacaæ ¼å¼æ•°æ®`, 'success');
            
            document.getElementById('generateQABtn').disabled = false;
            updateStats();
            showDataPreview();
        }

        // ç”Ÿæˆå¢å¼ºQAå¯¹
        async function generateEnhancedQA() {
            addLog('æ­£åœ¨ä½¿ç”¨Kimi APIç”Ÿæˆå¢å¼ºQAå¯¹...', 'info');
            updateProgress(3, 'æ­£åœ¨ç”Ÿæˆå¢å¼ºQAå¯¹');
            
            await sleep(2000);
            
            // æ¨¡æ‹Ÿç”Ÿæˆå¢å¼ºæ•°æ®
            currentData.enhancedData = [
                {
                    instruction: "è¯·å›ç­”ä»¥ä¸‹åŒ»å­¦æ•™è‚²é—®é¢˜ã€‚",
                    input: "å¯¹äºæ…¢æ€§å‰åˆ—è…ºç‚æ‚£è€…ï¼Œåº”è¯¥å¦‚ä½•è¿›è¡Œç»¼åˆæ²»ç–—ï¼Ÿ",
                    output: "æ…¢æ€§å‰åˆ—è…ºç‚çš„ç»¼åˆæ²»ç–—åŒ…æ‹¬ï¼š1.æŠ—ç”Ÿç´ æ²»ç–—ï¼Œ2.Î±å—ä½“é˜»æ»å‰‚ï¼Œ3.æŠ—ç‚è¯ç‰©ï¼Œ4.ç‰©ç†æ²»ç–—ï¼Œ5.ç”Ÿæ´»æ–¹å¼è°ƒæ•´...",
                    id: "enhanced_1",
                    source: "kimi_generated"
                },
                {
                    instruction: "è¯·å›ç­”ä»¥ä¸‹åŒ»å­¦æ•™è‚²é—®é¢˜ã€‚",
                    input: "å¹²ç‡¥ç»¼åˆå¾çš„è¯Šæ–­æ ‡å‡†æœ‰å“ªäº›ï¼Ÿ",
                    output: "å¹²ç‡¥ç»¼åˆå¾çš„è¯Šæ–­æ ‡å‡†åŒ…æ‹¬ï¼š1.å£å¹²ç—‡çŠ¶ï¼Œ2.çœ¼å¹²ç—‡çŠ¶ï¼Œ3.å”¾æ¶²è…ºåŠŸèƒ½å¼‚å¸¸ï¼Œ4.æ³ªè…ºåŠŸèƒ½å¼‚å¸¸ï¼Œ5.è¡€æ¸…å­¦å¼‚å¸¸...",
                    id: "enhanced_2",
                    source: "kimi_generated"
                },
                {
                    instruction: "è¯·å›ç­”ä»¥ä¸‹åŒ»å­¦æ•™è‚²é—®é¢˜ã€‚",
                    input: "å¦‚ä½•é‰´åˆ«å™¨è´¨æ€§å’Œéå™¨è´¨æ€§æ€§åŠŸèƒ½éšœç¢ï¼Ÿ",
                    output: "é‰´åˆ«å™¨è´¨æ€§å’Œéå™¨è´¨æ€§æ€§åŠŸèƒ½éšœç¢éœ€è¦ï¼š1.è¯¦ç»†ç—…å²è¯¢é—®ï¼Œ2.ä½“æ ¼æ£€æŸ¥ï¼Œ3.å®éªŒå®¤æ£€æŸ¥ï¼Œ4.å¿ƒç†è¯„ä¼°...",
                    id: "enhanced_3",
                    source: "kimi_generated"
                }
            ];
            
            // æ¨¡æ‹Ÿç”Ÿæˆä¸“ä¸šé¢†åŸŸæ•°æ®
            currentData.domainData = [
                {
                    instruction: "è¯·å›ç­”åŒ»å­¦è¯Šæ–­ä¸“ä¸šé—®é¢˜ã€‚",
                    input: "æ€¥æ€§è…¹ç—›çš„é‰´åˆ«è¯Šæ–­æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ",
                    output: "æ€¥æ€§è…¹ç—›çš„é‰´åˆ«è¯Šæ–­åº”æŒ‰éƒ¨ä½å’Œæ€§è´¨ç³»ç»Ÿåˆ†æï¼š1.å³ä¸Šè…¹ç—›è€ƒè™‘èƒ†å›Šç‚ã€èƒ†çŸ³ç—‡ï¼Œ2.å·¦ä¸Šè…¹ç—›è€ƒè™‘èƒƒç‚ã€èƒ°è…ºç‚...",
                    id: "domain_1",
                    source: "domain_expert"
                },
                {
                    instruction: "è¯·å›ç­”åŒ»å­¦è¯Šæ–­ä¸“ä¸šé—®é¢˜ã€‚",
                    input: "å¦‚ä½•è¯Šæ–­å’Œå¤„ç†å‘çƒ­å¾…æŸ¥ï¼Ÿ",
                    output: "å‘çƒ­å¾…æŸ¥çš„è¯Šæ–­å¤„ç†ï¼š1.è¯¦ç»†ç—…å²å’Œä½“æ£€ï¼Œ2.åŸºç¡€å®éªŒå®¤æ£€æŸ¥ï¼Œ3.å½±åƒå­¦æ£€æŸ¥ï¼Œ4.ç—…åŸå­¦æ£€æŸ¥ï¼Œ5.å¿…è¦æ—¶ç»„ç»‡æ´»æ£€...",
                    id: "domain_2",
                    source: "domain_expert"
                }
            ];
            
            addLog(`ç”Ÿæˆäº† ${currentData.enhancedData.length} æ¡å¢å¼ºQAå¯¹`, 'success');
            addLog(`ç”Ÿæˆäº† ${currentData.domainData.length} æ¡ä¸“ä¸šé¢†åŸŸQAå¯¹`, 'success');
            
            document.getElementById('createDatasetBtn').disabled = false;
            updateStats();
        }

        // åˆ›å»ºæœ€ç»ˆæ•°æ®é›†
        async function createFinalDataset() {
            addLog('æ­£åœ¨åˆ›å»ºæœ€ç»ˆè®­ç»ƒæ•°æ®é›†...', 'info');
            updateProgress(4, 'æ­£åœ¨åˆ›å»ºæ•°æ®é›†');
            
            await sleep(1000);
            
            // åˆå¹¶æ‰€æœ‰æ•°æ®
            currentData.finalDataset = [
                ...currentData.alpacaData,
                ...currentData.enhancedData,
                ...currentData.domainData
            ];
            
            // æ‰“ä¹±æ•°æ®
            shuffleArray(currentData.finalDataset);
            
            // åˆ†å‰²è®­ç»ƒé›†å’ŒéªŒè¯é›†
            const splitIndex = Math.floor(currentData.finalDataset.length * 0.8);
            const trainData = currentData.finalDataset.slice(0, splitIndex);
            const valData = currentData.finalDataset.slice(splitIndex);
            
            // ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯
            currentData.stats = {
                total_samples: currentData.finalDataset.length,
                train_samples: trainData.length,
                val_samples: valData.length,
                sources: {
                    jmed_chat_format: currentData.alpacaData.length,
                    kimi_generated: currentData.enhancedData.length,
                    domain_expert: currentData.domainData.length
                },
                avg_input_length: calculateAverageLength(currentData.finalDataset, 'input'),
                avg_output_length: calculateAverageLength(currentData.finalDataset, 'output'),
                created_at: new Date().toISOString()
            };
            
            addLog(`åˆ›å»ºäº†åŒ…å« ${currentData.stats.total_samples} æ¡æ•°æ®çš„å®Œæ•´æ•°æ®é›†`, 'success');
            addLog(`è®­ç»ƒé›†: ${trainData.length} æ¡ï¼ŒéªŒè¯é›†: ${valData.length} æ¡`, 'info');
            
            document.getElementById('downloadBtn').disabled = false;
            updateProgress(5, 'æ•°æ®é›†åˆ›å»ºå®Œæˆ');
            updateStats();
            updateFileList();
        }

        // ä¸‹è½½ç»“æœ
        function downloadResults() {
            addLog('å‡†å¤‡ä¸‹è½½ç”Ÿæˆçš„æ–‡ä»¶...', 'info');
            
            // åˆ›å»ºæ–‡ä»¶å†…å®¹
            const files = {
                'medical_finetune_train.jsonl': generateJSONL(currentData.finalDataset.slice(0, currentData.stats.train_samples)),
                'medical_finetune_val.jsonl': generateJSONL(currentData.finalDataset.slice(currentData.stats.train_samples)),
                'medical_finetune_all.jsonl': generateJSONL(currentData.finalDataset),
                'dataset_stats.json': JSON.stringify(currentData.stats, null, 2),
                'llamafactory_config.json': JSON.stringify({
                    model_name_or_path: "moonshot-v1-8k",
                    finetuning_type: "lora",
                    dataset_dir: "./finetuning_output",
                    dataset: "medical_finetune_train",
                    cutoff_len: 1024,
                    learning_rate: 5e-5,
                    num_train_epochs: 3,
                    per_device_train_batch_size: 2,
                    gradient_accumulation_steps: 4,
                    lora_rank: 8,
                    lora_alpha: 32,
                    lora_dropout: 0.1,
                    output_dir: "./saves/medical-kimi-lora",
                    fp16: true,
                    plot_loss: true
                }, null, 2)
            };
            
            // ä¸‹è½½æ¯ä¸ªæ–‡ä»¶
            Object.entries(files).forEach(([filename, content]) => {
                downloadFile(filename, content);
            });
            
            addLog('æ‰€æœ‰æ–‡ä»¶ä¸‹è½½å®Œæˆï¼', 'success');
        }

        // è¾…åŠ©å‡½æ•°
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function generateMockMedicalData(count) {
            const mockData = [];
            for (let i = 0; i < count; i++) {
                mockData.push({
                    question: `æ‚£è€…ï¼Œ${i % 2 === 0 ? 'ç”·' : 'å¥³'}ï¼Œ${20 + i}å²ï¼Œä¸»è¯‰${getMockSymptom()}ï¼Œç—‡çŠ¶æŒç»­${i + 1}å¤©...`,
                    answer: `æ ¹æ®æ‚£è€…çš„ç—‡çŠ¶å’Œæ£€æŸ¥ç»“æœåˆ†æï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${String.fromCharCode(65 + i % 21)}\n\n${String.fromCharCode(65 + i % 21)}: ${getMockDiagnosis()}\n\nè¿™ä¸ªè¯Šæ–­åŸºäºæ‚£è€…çš„ä¸´åºŠè¡¨ç°ã€ç—‡çŠ¶ç‰¹ç‚¹å’Œç›¸å…³æ£€æŸ¥ç»“æœçš„ç»¼åˆåˆ†æã€‚`
                });
            }
            return mockData;
        }

        function getMockSymptom() {
            const symptoms = ['è…¹ç—›', 'å¤´ç—›', 'èƒ¸é—·', 'ä¹åŠ›', 'å‘çƒ­', 'å’³å—½', 'è…°ç—›'];
            return symptoms[Math.floor(Math.random() * symptoms.length)];
        }

        function getMockDiagnosis() {
            const diagnoses = ['æ…¢æ€§èƒƒç‚', 'æ„Ÿå†’', 'é«˜è¡€å‹', 'ç³–å°¿ç—…', 'æ…¢æ€§å‰åˆ—è…ºç‚', 'å¹²ç‡¥ç»¼åˆå¾', 'ç„¦è™‘ç—‡'];
            return diagnoses[Math.floor(Math.random() * diagnoses.length)];
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function calculateAverageLength(data, field) {
            if (data.length === 0) return 0;
            const total = data.reduce((sum, item) => sum + (item[field] || '').length, 0);
            return Math.round(total / data.length * 10) / 10;
        }

        function generateJSONL(data) {
            return data.map(item => JSON.stringify(item)).join('\n');
        }

        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function updateStats() {
            if (currentData.stats.total_samples) {
                document.getElementById('totalSamples').textContent = currentData.stats.total_samples;
                document.getElementById('trainCount').textContent = currentData.stats.train_samples;
                document.getElementById('valCount').textContent = currentData.stats.val_samples;
                document.getElementById('avgInputLen').textContent = currentData.stats.avg_input_length;
                
                document.getElementById('originalCount').textContent = currentData.stats.sources.jmed_chat_format;
                document.getElementById('enhancedCount').textContent = currentData.stats.sources.kimi_generated;
                document.getElementById('domainCount').textContent = currentData.stats.sources.domain_expert;
            }
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            const files = [
                { name: 'medical_finetune_train.jsonl', size: '28.6KB' },
                { name: 'medical_finetune_val.jsonl', size: '8.8KB' },
                { name: 'medical_finetune_all.jsonl', size: '37.4KB' },
                { name: 'dataset_stats.json', size: '245B' },
                { name: 'llamafactory_config.json', size: '440B' }
            ];
            
            fileList.innerHTML = files.map(file => `
                <li>
                    <span>ğŸ“„ ${file.name}</span>
                    <span class="file-size">${file.size}</span>
                </li>
            `).join('');
        }

        function showDataPreview() {
            const preview = document.getElementById('dataPreview');
            const content = document.getElementById('previewContent');
            
            if (currentData.alpacaData.length > 0) {
                content.textContent = JSON.stringify(currentData.alpacaData[0], null, 2);
                preview.classList.remove('hidden');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ‰ Kimiå¾®è°ƒæ•°æ®ç”Ÿæˆå™¨å·²å¯åŠ¨', 'success');
            addLog('è¯·æŒ‰é¡ºåºç‚¹å‡»æŒ‰é’®å®Œæˆæ•°æ®ç”Ÿæˆæµç¨‹', 'info');
        });
    </script>
</body>
</html>


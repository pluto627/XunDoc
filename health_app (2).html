<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康助手 - 个人健康管理</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-bg: #ffffff;
            --color-bg-secondary: #fafafa;
            --color-bg-tertiary: #f5f5f5;
            --color-text-primary: #37352f;
            --color-text-secondary: #787774;
            --color-text-tertiary: #9b9a97;
            --color-border: #e9e9e7;
            --color-border-light: #f1f1ef;
            --color-accent: #37352f;
            --color-accent-light: #e8e7e5;
            --color-success: #4a5568;
            --color-warning: #6b7280;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 100%;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        #page-records .app-container {
            padding-bottom: 80px;
        }

        /* Header */
        .header {
            background-color: var(--color-bg);
            border-bottom: 1px solid var(--color-border-light);
            padding: 24px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(8px);
            background-color: rgba(255, 255, 255, 0.95);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .header-title h1 {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: -0.02em;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .header-subtitle {
            font-size: 13px;
            color: var(--color-text-tertiary);
            font-weight: 400;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background-color: transparent;
            color: var(--color-text-tertiary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background-color: var(--color-bg-tertiary);
            color: var(--color-text-secondary);
        }

        /* Main Content */
        .main-content {
            padding: 0 20px 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Section */
        .section {
            margin-top: 32px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Cards */
        .card {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .card:hover {
            border-color: var(--color-text-tertiary);
            box-shadow: var(--shadow-sm);
        }

        .card-minimal {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border-light);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .card-minimal:hover {
            background-color: var(--color-bg-secondary);
        }

        /* Overview Cards */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }

        .overview-card {
            background-color: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            padding: 20px 16px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .overview-card:hover {
            background-color: var(--color-bg-tertiary);
        }

        .overview-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .overview-label {
            font-size: 12px;
            color: var(--color-text-tertiary);
            margin-bottom: 4px;
        }

        .overview-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--color-text-primary);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .action-card {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
        }

        .action-card:hover {
            border-color: var(--color-text-tertiary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .action-icon {
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--color-text-secondary);
        }

        .action-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .action-desc {
            font-size: 13px;
            color: var(--color-text-tertiary);
        }


        /* Upload Area */
        .upload-area {
            border: 2px dashed var(--color-border);
            border-radius: 20px;
            padding: 48px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--color-bg-secondary);
        }

        .upload-area:hover {
            border-color: var(--color-text-tertiary);
            background-color: var(--color-bg-tertiary);
        }

        .upload-text {
            font-size: 14px;
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }

        .upload-hint {
            font-size: 12px;
            color: var(--color-text-tertiary);
            margin-bottom: 16px;
        }

        .upload-btn {
            background-color: var(--color-accent);
            color: var(--color-bg);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .upload-btn:hover {
            background-color: var(--color-text-primary);
        }

        /* Item Card */
        .item-card {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .item-card:hover {
            background-color: var(--color-bg-secondary);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .item-title {
            font-size: 15px;
            font-weight: 500;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .item-meta {
            font-size: 12px;
            color: var(--color-text-tertiary);
        }

        .item-content {
            background-color: var(--color-bg-secondary);
            border-radius: 12px;
            padding: 12px;
            font-size: 13px;
            color: var(--color-text-secondary);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .item-actions {
            display: flex;
            gap: 16px;
        }

        .item-action {
            font-size: 12px;
            color: var(--color-text-secondary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .item-action:hover {
            color: var(--color-text-primary);
        }

        /* Tag/Badge */
        .tag {
            display: inline-block;
            padding: 4px 8px;
            background-color: var(--color-bg-tertiary);
            color: var(--color-text-secondary);
            font-size: 11px;
            border-radius: 6px;
            font-weight: 500;
        }

        .tag.success {
            background-color: #d1fae5;
            color: #065f46;
        }

        /* Medication Item */
        .medication-item-wrapper {
            position: relative;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .medication-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            transition: transform 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .medication-item.swiping {
            transition: none;
        }

        .medication-item:hover {
            background-color: var(--color-bg-secondary);
        }

        .medication-delete-btn {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 80px;
            background-color: #dc2626;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0 20px 20px 0;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 0;
        }

        .medication-delete-btn:hover {
            background-color: #b91c1c;
        }

        .medication-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--color-border);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .checkbox.checked {
            background-color: var(--color-text-primary);
            border-color: var(--color-text-primary);
            position: relative;
        }

        .checkbox.checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .medication-info {
            flex: 1;
        }

        .medication-name {
            font-size: 15px;
            font-weight: 500;
            color: var(--color-text-primary);
            margin-bottom: 2px;
        }

        .medication-name.completed {
            color: var(--color-text-tertiary);
            text-decoration: line-through;
        }

        .medication-dosage {
            font-size: 12px;
            color: var(--color-text-tertiary);
        }

        .medication-time {
            text-align: right;
        }

        .medication-time-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-primary);
            margin-bottom: 2px;
        }

        .medication-status {
            font-size: 11px;
            color: var(--color-text-tertiary);
        }

        .medication-status.completed {
            color: var(--color-success);
        }

        /* Home page medication checkbox */
        .home-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--color-border);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
            position: relative;
        }

        .home-checkbox:hover {
            border-color: var(--color-text-tertiary);
        }

        .home-checkbox.checked {
            background-color: var(--color-text-primary);
            border-color: var(--color-text-primary);
        }

        .home-checkbox.checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Medication list item (for medication page) */
        .med-list-item {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border-light);
            border-radius: 20px;
            padding: 16px 20px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .med-list-item:hover {
            background-color: var(--color-bg-secondary);
            border-color: var(--color-border);
        }

        .med-list-name {
            font-size: 16px;
            font-weight: 500;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .med-list-info {
            font-size: 13px;
            color: var(--color-text-tertiary);
        }

        /* Add Button */
        .add-card {
            border: 2px dashed var(--color-border);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--color-bg-secondary);
        }

        .add-card:hover {
            border-color: var(--color-text-tertiary);
            background-color: var(--color-bg-tertiary);
        }

        .add-icon {
            font-size: 24px;
            color: var(--color-text-tertiary);
            margin-bottom: 8px;
        }

        .add-text {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-secondary);
        }

        /* Stats Card */
        .stats-card {
            background-color: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            padding: 24px;
        }

        .stats-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--color-text-tertiary);
        }

        /* Navigation */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-top: 1px solid var(--color-border-light);
            padding: 8px 0;
            z-index: 100;
            display: block;
        }

        #page-records .nav-bar,
        #page-case-detail .nav-bar {
            display: none;
        }

        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 480px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            cursor: pointer;
            color: var(--color-text-tertiary);
            border-radius: 12px;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .nav-item:hover {
            background-color: var(--color-bg-tertiary);
        }

        .nav-item.active {
            color: var(--color-text-primary);
            background-color: var(--color-accent-light);
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        /* Divider */
        .divider {
            height: 1px;
            background-color: var(--color-border-light);
            margin: 24px 0;
        }

        /* Status Dot */
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-dot.active {
            background-color: var(--color-warning);
        }

        .status-dot.completed {
            background-color: var(--color-success);
        }

        /* AI Analysis */
        .ai-analysis {
            background-color: var(--color-bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }

        .ai-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ai-content {
            font-size: 13px;
            color: var(--color-text-secondary);
            line-height: 1.6;
        }

        /* Hide/Show Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Case File Card */
        .case-file-card {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .case-file-card:hover {
            border-color: var(--color-text-tertiary);
            box-shadow: var(--shadow-sm);
        }

        .case-file-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .case-file-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .case-file-meta {
            font-size: 12px;
            color: var(--color-text-tertiary);
        }

        .case-file-badges {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .case-file-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background-color: var(--color-bg-tertiary);
            border-radius: 6px;
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        .case-file-badge svg {
            width: 12px;
            height: 12px;
        }

        /* Case Detail Modal (using as hidden div for now) */
        .case-content-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--color-border-light);
        }

        .case-content-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: var(--color-bg-secondary);
            border-radius: 12px;
            margin-bottom: 8px;
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .case-content-item svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        /* Quick Actions Bar for Records Page */
        .quick-actions-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-top: 1px solid var(--color-border-light);
            padding: 8px 0;
            z-index: 100;
            display: none;
        }

        /* Global Bottom Navigation */
        .bottom-nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-top: 1px solid var(--color-border-light);
            padding: 8px 0 12px;
            z-index: 100;
        }

        .bottom-nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 480px;
            margin: 0 auto;
            padding: 0 12px;
        }

        .bottom-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            cursor: pointer;
            color: var(--color-text-tertiary);
            border-radius: 12px;
            transition: all 0.2s ease;
            background: none;
            border: none;
            flex: 1;
            position: relative;
        }

        .bottom-nav-btn:hover {
            color: var(--color-text-secondary);
        }

        .bottom-nav-btn.active {
            color: var(--color-text-primary);
            /* 去除选中背景 */
        }

        .bottom-nav-btn svg {
            width: 20px;
            height: 20px;
        }

        .bottom-nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        .bottom-nav-center-btn {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background-color: var(--color-accent);
            color: var(--color-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            margin: 0 4px;
            position: relative;
            z-index: 101;
            transform: translateY(-20px);
        }

        .bottom-nav-center-btn:hover {
            transform: translateY(-20px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        .bottom-nav-center-btn svg {
            width: 28px;
            height: 28px;
        }

        .quick-actions-bar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 480px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            cursor: pointer;
            color: var(--color-text-tertiary);
            border-radius: 12px;
            transition: all 0.2s ease;
            background: none;
            border: none;
            flex: 1;
        }

        .quick-action-btn:hover {
            background-color: var(--color-bg-tertiary);
            color: var(--color-text-secondary);
        }

        .quick-action-btn svg {
            width: 20px;
            height: 20px;
        }

        .quick-action-label {
            font-size: 11px;
            font-weight: 500;
        }

        .center-record-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--color-accent);
            color: var(--color-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            margin: 0 8px;
            position: relative;
        }

        .center-record-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .center-record-btn svg {
            width: 24px;
            height: 24px;
        }

        .center-record-btn.active {
            background-color: #dc2626;
            animation: pulse 2s infinite;
        }

        /* Floating Quick Add Menu */
        .quick-add-menu {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            padding: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            display: none;
            flex-direction: column;
            gap: 8px;
            z-index: 101;
            min-width: 280px;
        }

        /* FAB Button for Records Page */
        .fab {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            background-color: var(--color-accent);
            color: var(--color-bg);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 99;
        }

        #page-records .fab {
            display: flex;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .quick-add-menu.active {
            display: flex;
        }

        .quick-add-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-add-item:hover {
            background-color: var(--color-bg-tertiary);
        }

        .quick-add-item svg {
            width: 20px;
            height: 20px;
            color: var(--color-text-secondary);
        }

        .quick-add-item-content {
            flex: 1;
        }

        .quick-add-item-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-primary);
        }

        .quick-add-item-desc {
            font-size: 12px;
            color: var(--color-text-tertiary);
        }

        /* Case Detail Page */
        .case-detail-header {
            background-color: var(--color-bg-secondary);
            padding: 20px;
            border-bottom: 1px solid var(--color-border-light);
        }

        .case-detail-header-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 8px;
        }

        .case-detail-header-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--color-text-tertiary);
        }

        .case-detail-content {
            padding: 20px;
        }

        .detail-section {
            margin-bottom: 32px;
        }

        .detail-section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-section-title svg {
            width: 20px;
            height: 20px;
        }

        /* Medication Detail Section */
        .medication-detail-section {
            margin-bottom: 2px;
            padding-bottom: 2px;
            border-bottom: 1px solid var(--color-border-light);
        }

        .medication-detail-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .detail-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-tertiary);
            margin-bottom: 2px;
        }

        .detail-value {
            font-size: 15px;
            color: var(--color-text-primary);
            line-height: 1.5;
        }

        /* Edit input styles in medication detail */
        .medication-detail-section .form-input,
        .medication-detail-section .form-textarea {
            margin-top: 4px;
            font-size: 15px;
        }

        .audio-player {
            background-color: var(--color-bg-secondary);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .audio-play-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--color-accent);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        .audio-info {
            flex: 1;
        }

        .audio-title {
            font-size: 15px;
            font-weight: 500;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .audio-duration {
            font-size: 13px;
            color: var(--color-text-tertiary);
        }

        .report-image {
            width: 100%;
            border-radius: 16px;
            background-color: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            aspect-ratio: 3/4;
            object-fit: cover;
        }

        .prescription-image {
            width: 100%;
            border-radius: 16px;
            background-color: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            aspect-ratio: 4/3;
            object-fit: cover;
        }

        .ocr-text {
            background-color: var(--color-bg-secondary);
            border-radius: 12px;
            padding: 16px;
            font-size: 14px;
            line-height: 1.6;
            color: var(--color-text-secondary);
            white-space: pre-wrap;
        }

        .ai-analysis-box {
            background-color: var(--color-bg-secondary);
            border-radius: 16px;
            padding: 20px;
        }

        .ai-analysis-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ai-analysis-content {
            font-size: 14px;
            line-height: 1.6;
            color: var(--color-text-secondary);
        }

        .ai-chat {
            background-color: var(--color-bg-secondary);
            border-radius: 16px;
            padding: 20px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
        }

        .ai-chat-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ai-chat-messages {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .chat-message {
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
        }

        .chat-message.user {
            background-color: var(--color-accent);
            color: white;
            align-self: flex-end;
            max-width: 80%;
        }

        .chat-message.ai {
            background-color: var(--color-bg-tertiary);
            color: var(--color-text-secondary);
            align-self: flex-start;
            max-width: 80%;
        }

        .ai-chat-input {
            display: flex;
            gap: 8px;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--color-border);
            border-radius: 24px;
            background-color: var(--color-bg);
            font-size: 14px;
            color: var(--color-text-primary);
            outline: none;
        }

        .ai-chat-input button {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--color-accent);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .header {
                padding: 20px 16px;
            }

            .main-content {
                padding: 0 16px 16px;
            }

            .overview-grid {
                gap: 8px;
            }

            .overview-card {
                padding: 16px 12px;
            }
        }

        /* Bottom Panel Styles */
        .bottom-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: flex-end;
            animation: fadeIn 0.3s ease;
        }

        .bottom-panel-overlay.active {
            display: flex;
        }

        .bottom-panel {
            background-color: var(--color-bg);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-height: 90vh;
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.15);
        }

        .step-panel {
            max-height: 85vh;
        }

        .bottom-panel-overlay.active .bottom-panel {
            transform: translateY(0);
        }

        .bottom-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--color-border-light);
        }

        .bottom-panel-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--color-text-primary);
        }

        .bottom-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        #quickAddPanel .bottom-panel-content {
            padding: 20px 16px;
        }

        .bottom-panel-footer {
            display: flex;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid var(--color-border-light);
            background-color: var(--color-bg);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-primary);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            background-color: var(--color-bg-secondary);
            font-size: 15px;
            color: var(--color-text-primary);
            outline: none;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            border-color: var(--color-text-tertiary);
            background-color: var(--color-bg);
        }

        /* Input with Icon */
        .input-with-icon {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-with-icon .form-input {
            padding-right: 48px;
        }

        .camera-icon-btn {
            position: absolute;
            right: 8px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            border: none;
            border-radius: 8px;
            color: var(--color-text-tertiary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .camera-icon-btn:hover {
            background-color: var(--color-bg-tertiary);
            color: var(--color-text-secondary);
        }

        .camera-icon-btn:active {
            transform: scale(0.95);
        }

        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            background-color: var(--color-bg-secondary);
            font-size: 15px;
            color: var(--color-text-primary);
            outline: none;
            transition: all 0.2s ease;
            resize: vertical;
            font-family: inherit;
        }

        .form-textarea:focus {
            border-color: var(--color-text-tertiary);
            background-color: var(--color-bg);
        }

        /* Time Buttons */
        .time-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .time-btn {
            padding: 10px 8px;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .time-btn:hover {
            background-color: var(--color-bg-tertiary);
        }

        .time-btn.active {
            background-color: var(--color-accent);
            color: var(--color-bg);
            border-color: var(--color-accent);
        }

        /* Frequency Buttons */
        .frequency-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .frequency-btn {
            padding: 10px 8px;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .frequency-btn:hover {
            background-color: var(--color-bg-tertiary);
        }

        .frequency-btn.active {
            background-color: var(--color-accent);
            color: var(--color-bg);
            border-color: var(--color-accent);
        }

        /* Buttons */
        .btn-primary {
            flex: 1;
            padding: 14px 24px;
            background-color: var(--color-accent);
            color: var(--color-bg);
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background-color: var(--color-text-primary);
        }

        .btn-secondary {
            flex: 1;
            padding: 14px 24px;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background-color: var(--color-bg-tertiary);
        }

        /* Step Panel Styles */
        .step-panel {
            padding-top: 0;
        }

        .step-progress {
            padding: 20px 24px;
            border-bottom: 1px solid var(--color-border-light);
        }

        .step-progress-bar {
            height: 4px;
            background-color: var(--color-bg-tertiary);
            border-radius: 2px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .step-progress-fill {
            height: 100%;
            background-color: var(--color-accent);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 16.67%;
        }

        .step-indicators {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--color-bg-tertiary);
            color: var(--color-text-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .step-indicator.active .step-number {
            background-color: var(--color-accent);
            color: var(--color-bg);
        }

        .step-indicator.completed .step-number {
            background-color: var(--color-success);
            color: var(--color-bg);
        }

        .step-label {
            font-size: 11px;
            color: var(--color-text-tertiary);
            transition: all 0.3s ease;
        }

        .step-indicator.active .step-label {
            color: var(--color-text-primary);
            font-weight: 500;
        }

        .step-content {
            display: none;
            flex-direction: column;
            min-height: 400px;
            overflow-y: auto;
        }

        .step-content.active {
            display: flex;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .step-header {
            padding: 32px 24px 24px;
            text-align: center;
        }

        .step-header h2 {
            font-size: 24px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 8px;
        }

        .step-subtitle {
            font-size: 14px;
            color: var(--color-text-tertiary);
        }

        .step-body {
            flex: 1;
            padding: 0 24px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .step-input {
            font-size: 18px;
            padding: 16px;
            text-align: center;
        }

        .time-input-group {
            margin-bottom: 20px;
        }

        .time-input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-primary);
        }

        .time-input-group input[type="time"] {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            text-align: center;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-primary);
            outline: none;
            transition: all 0.2s ease;
        }

        .time-input-group input[type="time"]:focus {
            border-color: var(--color-text-tertiary);
            background-color: var(--color-bg);
        }

        .step-textarea {
            font-size: 15px;
            min-height: 120px;
        }

        .large-btn {
            padding: 24px 16px;
            flex-direction: column;
            gap: 8px;
            border-radius: 16px;
        }

        .btn-icon {
            font-size: 32px;
            margin-bottom: 4px;
        }

        .btn-text {
            font-size: 15px;
            font-weight: 500;
        }

        .btn-time {
            font-size: 12px;
            color: var(--color-text-tertiary);
        }

        .time-btn.active .btn-time,
        .frequency-btn.active .btn-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .dosage-type-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .dosage-type-btn {
            padding: 24px 16px;
            border: 1px solid var(--color-border);
            border-radius: 16px;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .dosage-type-btn:hover {
            background-color: var(--color-bg-tertiary);
        }

        .dosage-type-btn.active {
            background-color: var(--color-accent);
            color: var(--color-bg);
            border-color: var(--color-accent);
        }

        .step-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--color-border-light);
            display: flex;
            gap: 12px;
        }

        /* Medication Detail */
        .medication-detail-section {
            margin-bottom: 24px;
        }

        .detail-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--color-text-tertiary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            font-size: 15px;
            color: var(--color-text-primary);
            line-height: 1.6;
        }

        .medication-name {
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .medication-name:hover {
            color: var(--color-accent);
        }

        /* Add Feature Grid - Vertical List */
        .add-feature-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .add-feature-card {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .add-feature-card:hover {
            border-color: var(--color-text-tertiary);
            box-shadow: var(--shadow-sm);
            transform: translateY(-2px);
        }

        .add-feature-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-bg-secondary);
            border-radius: 12px;
            color: var(--color-text-secondary);
            flex-shrink: 0;
        }

        .add-feature-icon svg {
            width: 24px;
            height: 24px;
        }

        .add-feature-content {
            flex: 1;
        }

        .add-feature-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .add-feature-desc {
            font-size: 13px;
            color: var(--color-text-tertiary);
        }

        /* Record Button */
        .record-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .record-btn:hover {
            background-color: var(--color-bg-tertiary);
        }

        .record-btn.recording {
            background-color: #dc2626;
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Upload Image */
        .upload-image-btn {
            width: 100%;
            padding: 60px 20px;
            border: 2px dashed var(--color-border);
            border-radius: 16px;
            background-color: var(--color-bg-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            margin-bottom: 16px;
        }

        .upload-image-btn:hover {
            border-color: var(--color-text-tertiary);
            background-color: var(--color-bg-tertiary);
        }

        .upload-image-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .upload-image-text {
            font-size: 15px;
            font-weight: 500;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .upload-image-desc {
            font-size: 13px;
            color: var(--color-text-tertiary);
        }

        .uploaded-image {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        /* Add to Case Button */
        .btn-add-to-case {
            flex: 1;
            padding: 8px 12px;
            background-color: var(--color-accent);
            color: var(--color-bg);
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-add-to-case:hover {
            background-color: var(--color-text-primary);
        }

        .btn-delete-pending {
            width: 36px;
            height: 36px;
            padding: 0;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-tertiary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-delete-pending:hover {
            background-color: #dc2626;
            color: white;
        }

        /* Action Menu */
        .action-menu-container {
            position: relative;
        }

        .action-menu-btn {
            width: 36px;
            height: 36px;
            padding: 0;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-tertiary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-menu-btn:hover {
            background-color: var(--color-bg-tertiary);
            color: var(--color-text-secondary);
        }

        .action-menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            min-width: 160px;
            z-index: 1000;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.2s ease;
        }

        .action-menu-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .action-menu-item {
            padding: 12px 16px;
            font-size: 14px;
            color: var(--color-text-primary);
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .action-menu-item:hover {
            background-color: var(--color-bg-secondary);
        }

        .action-menu-item.danger {
            color: #dc2626;
        }

        .action-menu-item.danger:hover {
            background-color: #fef2f2;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--color-border);
            transition: 0.3s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--color-accent);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Home Page -->
        <div id="page-home" class="page active">
            <div class="header">
                <div class="header-content">
                    <div class="header-title">
                        <h1>健康助手</h1>
                        <div class="header-subtitle">个人健康管理中心</div>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="m21 21-4.35-4.35" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="icon-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <!-- 数据概览 -->
                <div class="section">
                    <div class="overview-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="overview-card">
                            <div class="overview-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 8h12M6 12h12M6 16h12M10 4h4v2h-4V4zM8 6v14h12V6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="overview-label">待服用</div>
                            <div class="overview-value">2</div>
                        </div>
                        <div class="overview-card">
                            <div class="overview-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="overview-label">病历总数</div>
                            <div class="overview-value">3</div>
                        </div>
                    </div>
                </div>

                <!-- 今日用药提醒 -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">今日用药</h2>
                    </div>
                    <div class="card-minimal" style="cursor: pointer;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="flex: 1;">
                                <div style="font-size: 16px; font-weight: 500; color: var(--color-text-primary);" id="home-med-name-1">阿司匹林</div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">
                                    <div style="font-size: 13px; color: var(--color-text-tertiary);">100mg</div>
                                    <div style="font-size: 13px; color: var(--color-text-tertiary);">09:00</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 13px; color: var(--color-text-secondary);">完成用药</span>
                                <div class="home-checkbox" id="home-checkbox-1" onclick="toggleHomeMedication(1, event)"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card-minimal" style="cursor: pointer;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="flex: 1;">
                                <div style="font-size: 16px; font-weight: 500; color: var(--color-text-primary);" id="home-med-name-3">降压药</div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">
                                    <div style="font-size: 13px; color: var(--color-text-tertiary);">5mg</div>
                                    <div style="font-size: 13px; color: var(--color-text-tertiary);">20:00</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 13px; color: var(--color-text-secondary);">完成用药</span>
                                <div class="home-checkbox" id="home-checkbox-3" onclick="toggleHomeMedication(3, event)"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 最近病历 -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">最近病历</h2>
                        <a style="font-size: 13px; color: var(--color-text-secondary); text-decoration: none;" onclick="switchPage('records')">查看全部</a>
                    </div>
                    <div class="case-file-card" onclick="viewCaseDetail(1)" style="cursor: pointer;">
                        <div class="case-file-header">
                            <div>
                                <div class="case-file-title">北京协和医院</div>
                                <div class="case-file-meta">2025-10-20 就诊</div>
                            </div>
                            <span class="tag">心血管科</span>
                        </div>
                        <div class="case-content-section">
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="12" x2="12" y1="19" y2="22" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>录音记录 - 张医生诊断（5分钟）</span>
                            </div>
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="14 2 14 8 20 8" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>检查报告 - 血常规、心电图</span>
                            </div>
                        </div>
                    </div>
                    <div class="case-file-card" onclick="viewCaseDetail(2)" style="cursor: pointer;">
                        <div class="case-file-header">
                            <div>
                                <div class="case-file-title">北京大学第三医院</div>
                                <div class="case-file-meta">2025-10-15 就诊</div>
                            </div>
                            <span class="tag">内科</span>
                        </div>
                        <div class="case-content-section">
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="12" x2="12" y1="19" y2="22" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>录音记录 - 李医生咨询（8分钟）</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Records Page (病历管理) -->
        <div id="page-records" class="page">
            <div class="header">
                <div class="header-content">
                    <div class="header-title">
                        <h1>就诊记录</h1>
                        <div class="header-subtitle">病历与档案管理</div>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn" onclick="createNewCase()" title="添加新医院病历" style="background-color: var(--color-accent); color: white;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
                                <line x1="12" y1="8" x2="12" y2="16" stroke-linecap="round" stroke-linejoin="round"/>
                                <line x1="8" y1="12" x2="16" y2="12" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <!-- 搜索栏 -->
                <div class="section" style="margin-top: 0;">
                    <div style="position: relative;">
                        <input type="text" placeholder="搜索医院、科室、日期..." 
                            style="width: 100%; padding: 12px 16px 12px 40px; border: 1px solid var(--color-border); border-radius: 16px; background-color: var(--color-bg-secondary); font-size: 14px; color: var(--color-text-primary); outline: none;"
                            onfocus="this.style.borderColor='var(--color-text-tertiary)'"
                            onblur="this.style.borderColor='var(--color-border)'">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" 
                            style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--color-text-tertiary); pointer-events: none;">
                            <circle cx="11" cy="11" r="8" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="m21 21-4.35-4.35" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                <!-- 待归档内容 -->
                <div class="section" id="pendingSection" style="display: none;">
                    <div id="pendingContent"></div>
                </div>

                <!-- 病历列表 -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">我的病历</h2>
                    </div>

                    <!-- 病历卡片1 -->
                    <div class="case-file-card" onclick="viewCaseDetail(1)">
                        <div class="case-file-header">
                            <div>
                                <div class="case-file-title">北京协和医院</div>
                                <div class="case-file-meta">2025-10-20 就诊</div>
                            </div>
                            <span class="tag">心血管科</span>
                        </div>
                        <div class="case-content-section">
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="12" x2="12" y1="19" y2="22" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>录音记录 - 张医生诊断（5分钟）</span>
                        </div>
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="14 2 14 8 20 8" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>检查报告 - 血常规、心电图</span>
                            </div>
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M8 8h8M8 12h8M8 16h8M10 4h4v2h-4V4zM6 6v14h12V6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>处方单 - 阿司匹林、降压药</span>
                            </div>
                        </div>
                    </div>

                    <!-- 病历卡片2 -->
                    <div class="case-file-card" onclick="viewCaseDetail(2)">
                        <div class="case-file-header">
                            <div>
                                <div class="case-file-title">北京大学第三医院</div>
                                <div class="case-file-meta">2025-10-15 就诊</div>
                            </div>
                            <span class="tag">内科</span>
                        </div>
                        <div class="case-content-section">
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="12" x2="12" y1="19" y2="22" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>录音记录 - 李医生咨询（8分钟）</span>
                        </div>
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="14 2 14 8 20 8" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>检查报告 - 血常规</span>
                            </div>
                        </div>
                    </div>

                    <!-- 病历卡片3 -->
                    <div class="case-file-card" onclick="viewCaseDetail(3)">
                        <div class="case-file-header">
                            <div>
                                <div class="case-file-title">北京朝阳医院</div>
                                <div class="case-file-meta">2025-10-10 就诊</div>
                            </div>
                            <span class="tag">骨科</span>
                        </div>
                        <div class="case-content-section">
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="14 2 14 8 20 8" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>检查报告 - X光片</span>
                            </div>
                            <div class="case-content-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M8 8h8M8 12h8M8 16h8M10 4h4v2h-4V4zM6 6v14h12V6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>处方单 - 止痛药</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Add Case Button (右下角，只在records页面显示) -->
            <button class="fab" onclick="createNewCase()" title="创建新病历" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="12" y1="8" x2="12" y2="16" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="8" y1="12" x2="16" y2="12" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>

        <!-- Case Detail Page -->
        <div id="page-case-detail" class="page">
            <div class="header">
                <div class="header-content">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button class="icon-btn" onclick="switchPage('records')" style="flex-shrink: 0;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    <div class="header-title">
                            <h1 id="detail-hospital-name">北京协和医院</h1>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="header-subtitle" id="detail-department">心血管科</div>
                                <div class="header-subtitle" id="detail-date">2025-10-20</div>
                            </div>
                    </div>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn" id="edit-case-btn" onclick="toggleEditCase()" title="编辑">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="icon-btn" id="save-case-btn" onclick="saveCaseChanges()" title="保存" style="display: none; background-color: var(--color-accent); color: white;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="case-detail-content">
                <!-- 病例基本信息 -->
                <div class="detail-section">
                    <div class="detail-section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" stroke-linecap="round" stroke-linejoin="round"/>
                            <polyline points="17 21 17 13 7 13 7 21" stroke-linecap="round" stroke-linejoin="round"/>
                            <polyline points="7 3 7 8 15 8" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        病例信息
                    </div>
                </div>

                <!-- 录音记录 -->
                <div class="detail-section">
                    <div class="detail-section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="12" x2="12" y1="19" y2="22" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        录音记录
                    </div>
                    <div class="audio-player">
                        <button class="audio-play-btn" onclick="toggleAudio('audio1')">
                            <svg id="audio-icon-1" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div class="audio-info">
                            <div class="audio-title">张医生诊断录音</div>
                            <div class="audio-duration">5分钟 · 2025-10-20</div>
                    </div>
                </div>
            </div>

                <!-- 检查报告 -->
                <div class="detail-section">
                    <div class="detail-section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-linecap="round" stroke-linejoin="round"/>
                            <polyline points="14 2 14 8 20 8" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        检查报告
                        </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <img src="https://via.placeholder.com/300x400" alt="血常规报告" class="report-image" onclick="previewImage(this.src)">
                        <img src="https://via.placeholder.com/300x400" alt="心电图报告" class="report-image" onclick="previewImage(this.src)">
                    </div>
                </div>

                <!-- 处方单 -->
                <div class="detail-section">
                    <div class="detail-section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M8 8h8M8 12h8M8 16h8M10 4h4v2h-4V4zM6 6v14h12V6" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        处方单
                    </div>
                    <img src="https://via.placeholder.com/400x300" alt="处方单" class="prescription-image" onclick="previewImage(this.src)">
                    
                    <div style="margin-top: 16px;">
                        <div class="detail-section-title" style="font-size: 14px; margin-bottom: 8px;">OCR识别文本</div>
                        <div class="ocr-text">
                            北京协和医院处方单

                            患者姓名：张三
                            性别：男
                            年龄：58岁
                            科室：心血管科
                            日期：2025-10-20

                            药品名称               规格        数量    用法用量
                            阿司匹林肠溶片        100mg       30片    每日一次，每次1片
                            降压药片              5mg         30片    每日一次，每次1片

                            医生签名：张医生
                            </div>
                        </div>
                        </div>

                <!-- AI解读报告 -->
                <div class="detail-section">
                    <div class="detail-section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="12" y1="17" x2="12.01" y2="17" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        AI解读报告
                    </div>
                    <div class="ai-analysis-box">
                        <div class="ai-analysis-title">智能分析</div>
                        <div class="ai-analysis-content">
                            根据您的检查报告和处方，AI分析如下：

                            1. 血常规检查结果正常，各项指标均在正常范围内，说明整体健康状况良好。

                            2. 心电图显示轻微ST段改变，建议定期复查。可能与心血管疾病相关，需要注意休息，避免过度劳累。

                            3. 处方用药合理：
                               - 阿司匹林用于抗血小板聚集，预防心血管事件
                               - 降压药用于控制血压
                               两项药物搭配使用，有助于心血管健康管理。

                            建议：保持规律作息，适度运动，按时服药，3个月后复查。
                        </div>
                        </div>
                    </div>

                <!-- AI问询 -->
                <div class="detail-section">
                    <div class="detail-section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                        AI问询
                            </div>
                    <div class="ai-chat">
                        <div class="ai-chat-title">基于报告内容提问</div>
                        <div class="ai-chat-messages" id="chatMessages">
                            <div class="chat-message ai">
                                您好！我是AI健康助手，我可以基于您的检查报告和处方内容回答相关问题。请问有什么想了解的吗？
                        </div>
                        </div>
                        <div class="ai-chat-input">
                            <input type="text" id="chatInput" placeholder="输入您的问题..." onkeypress="handleChatKeyPress(event)">
                            <button onclick="sendChatMessage()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                        </div>
                    </div>

        <!-- Quick Add Panel (从下往上滑出的添加页面) -->
        <div class="bottom-panel-overlay" id="quickAddPanel" onclick="closeQuickAddPanel()">
            <div class="bottom-panel" onclick="event.stopPropagation()">
                <div class="bottom-panel-header">
                    <h2>添加内容</h2>
                    <button class="icon-btn" onclick="closeQuickAddPanel()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
    <line x1="6" y1="6" x2="18" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="bottom-panel-content">
                    <!-- 功能卡片列表 - 竖向排列 -->
                    <div class="add-feature-grid">
                        <!-- 录音记录 -->
                        <div class="add-feature-card" onclick="showRecordingPanel()">
                            <div class="add-feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="12" x2="12" y1="19" y2="22" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                </div>
                            <div class="add-feature-content">
                                <div class="add-feature-title">录音记录</div>
                                <div class="add-feature-desc">医生诊断录音</div>
            </div>
                        </div>

                        <!-- 添加报告 -->
                        <div class="add-feature-card" onclick="showReportPanel()">
                            <div class="add-feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="14 2 14 8 20 8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                </div>
                            <div class="add-feature-content">
                                <div class="add-feature-title">添加报告</div>
                                <div class="add-feature-desc">上传报告单照片</div>
            </div>
                        </div>

                        <!-- 用药提醒 -->
                        <div class="add-feature-card" onclick="showMedicationPanel()">
                            <div class="add-feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M8 8h8M8 12h8M8 16h8M10 4h4v2h-4V4zM6 6v14h12V6" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                            </div>
                            <div class="add-feature-content">
                                <div class="add-feature-title">用药提醒</div>
                                <div class="add-feature-desc">添加用药信息</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recording Panel -->
        <div class="bottom-panel-overlay" id="recordingPanel" onclick="closeRecordingPanel()">
            <div class="bottom-panel" onclick="event.stopPropagation()">
                <div class="bottom-panel-header">
                    <h2>录音记录</h2>
                    <button class="icon-btn" onclick="closeRecordingPanel()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="6" y1="6" x2="18" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="bottom-panel-content">
                    <!-- 录音按钮 -->
                    <div class="form-group" style="text-align: center; margin-bottom: 32px;">
                        <button class="record-btn" id="recordBtn" onclick="toggleRecordAudio()">
                            <svg id="recordIcon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke-linecap="round" stroke-linejoin="round"/>
                                <line x1="12" x2="12" y1="19" y2="22" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div id="recordTime" style="font-size: 18px; font-weight: 600; color: var(--color-text-primary); margin-top: 12px;">00:00</div>
                        <div style="font-size: 13px; color: var(--color-text-tertiary); margin-top: 4px;">点击开始录音</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">录音标题 *</label>
                        <input type="text" id="recordingTitle" class="form-input" placeholder="如：张医生诊断">
                    </div>
                </div>
                <div class="bottom-panel-footer">
                    <button class="btn-secondary" onclick="closeRecordingPanel()">取消</button>
                    <button class="btn-primary" onclick="submitRecording()">保存</button>
                </div>
            </div>
        </div>

        <!-- Report Panel -->
        <div class="bottom-panel-overlay" id="reportPanel" onclick="closeReportPanel()">
            <div class="bottom-panel" onclick="event.stopPropagation()">
                <div class="bottom-panel-header">
                    <h2>添加报告</h2>
                    <button class="icon-btn" onclick="closeReportPanel()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="6" y1="6" x2="18" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="bottom-panel-content">
                    <!-- 上传照片 -->
                    <div id="reportImageContainer">
                        <div class="upload-image-btn" onclick="uploadReportImage()">
                            <input type="file" id="reportImageInput" accept="image/*" style="display: none;" onchange="handleReportImageUpload(event)">
                            <div class="upload-image-icon">📷</div>
                            <div class="upload-image-text">点击上传报告照片</div>
                            <div class="upload-image-desc">支持拍照或从相册选择</div>
                        </div>
                    </div>
                </div>
                <div class="bottom-panel-footer">
                    <button class="btn-secondary" onclick="closeReportPanel()">取消</button>
                    <button class="btn-primary" onclick="submitReport()">保存</button>
                </div>
            </div>
        </div>

        <!-- Case Selector Panel (选择病例面板) -->
        <div class="bottom-panel-overlay" id="caseSelectorPanel" onclick="closeCaseSelectorPanel()">
            <div class="bottom-panel" onclick="event.stopPropagation()">
                <div class="bottom-panel-header">
                    <h2>选择病历</h2>
                    <button class="icon-btn" onclick="closeCaseSelectorPanel()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="6" y1="6" x2="18" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="bottom-panel-content">
                    <div id="caseSelectorList"></div>
                </div>
            </div>
        </div>

        <!-- Medication Page -->
        <div id="page-medication" class="page">
            <div class="header">
                <div class="header-content">
                    <div class="header-title">
                        <h1>用药管理</h1>
                        <div class="header-subtitle">智能用药提醒</div>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">我的药物</h2>
                    </div>

                    <div class="med-list-item" id="med-list-1" onclick="showMedicationDetail(1)">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div class="med-list-name" id="med-list-name-1">阿司匹林</div>
                                <div class="med-list-info">09:00 · 100mg</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
                                <polyline points="12 6 12 12 16 14" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>

                    <div class="med-list-item" id="med-list-3" onclick="showMedicationDetail(3)">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div class="med-list-name" id="med-list-name-3">降压药</div>
                                <div class="med-list-info">20:00 · 5mg</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
                                <polyline points="12 6 12 12 16 14" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="add-card" onclick="openAddMedicationPanel()">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
                                <line x1="12" y1="8" x2="12" y2="16" stroke-linecap="round" stroke-linejoin="round"/>
                                <line x1="8" y1="12" x2="16" y2="12" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="add-text">添加新药物</div>
                        <div style="font-size: 11px; color: var(--color-text-tertiary); margin-top: 4px;">可拍照识别药品信息</div>
                    </div>
                </div>

                <div class="section">
                    <div class="stats-card">
                        <div class="stats-title">本周统计</div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">85%</div>
                                <div class="stat-label">按时服药率</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">21</div>
                                <div class="stat-label">总服药次数</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Medication Panel (多步骤表单) -->
        <div class="bottom-panel-overlay" id="addMedicationOverlay" onclick="closeAddMedicationPanel()">
            <div class="bottom-panel step-panel" id="addMedicationPanel" onclick="event.stopPropagation()">
                <!-- 进度指示器 -->
                <div class="step-progress">
                    <div class="step-progress-bar">
                        <div class="step-progress-fill" id="medicationProgressBar"></div>
                    </div>
                    <div class="step-indicators">
                        <div class="step-indicator active" id="step-1-indicator">
                            <div class="step-number">1</div>
                            <div class="step-label">名称</div>
                        </div>
                        <div class="step-indicator" id="step-2-indicator">
                            <div class="step-number">2</div>
                            <div class="step-label">剂型</div>
                        </div>
                        <div class="step-indicator" id="step-3-indicator">
                            <div class="step-number">3</div>
                            <div class="step-label">剂量</div>
                        </div>
                        <div class="step-indicator" id="step-4-indicator">
                            <div class="step-number">4</div>
                            <div class="step-label">频率</div>
                        </div>
                        <div class="step-indicator" id="step-5-indicator">
                            <div class="step-number">5</div>
                            <div class="step-label">时间</div>
                        </div>
                        <div class="step-indicator" id="step-6-indicator">
                            <div class="step-number">6</div>
                            <div class="step-label">备注</div>
                        </div>
                    </div>
                </div>

                <!-- 步骤1: 药品名称 -->
                <div class="step-content active" id="step-1">
                    <div class="step-header">
                        <h2>药品名称</h2>
                        <p class="step-subtitle">请输入或扫描药品名称</p>
                    </div>
                    <div class="step-body">
                        <div class="input-with-icon">
                            <input type="text" id="medicationName" class="form-input step-input" placeholder="如：阿司匹林肠溶片" autofocus>
                            <button class="camera-icon-btn" onclick="openCameraForMedicine()" type="button">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="12" cy="13" r="4" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="step-footer">
                        <button class="btn-secondary" onclick="closeAddMedicationPanel()">取消</button>
                        <button class="btn-primary" onclick="nextStep(1)">下一步</button>
                    </div>
                </div>

                <!-- 步骤2: 剂型选择 -->
                <div class="step-content" id="step-2">
                    <div class="step-header">
                        <h2>剂型</h2>
                        <p class="step-subtitle">选择药品的剂型</p>
                    </div>
                    <div class="step-body">
                        <div class="dosage-type-buttons" style="grid-template-columns: repeat(2, 1fr); gap: 12px;">
                            <button class="dosage-type-btn large-btn" onclick="selectDosageType('tablet')" id="type-tablet">
                                <div class="btn-icon">💊</div>
                                <div class="btn-text">片剂</div>
                            </button>
                            <button class="dosage-type-btn large-btn" onclick="selectDosageType('capsule')" id="type-capsule">
                                <div class="btn-icon">💉</div>
                                <div class="btn-text">胶囊</div>
                            </button>
                            <button class="dosage-type-btn large-btn" onclick="selectDosageType('granule')" id="type-granule">
                                <div class="btn-icon">📦</div>
                                <div class="btn-text">颗粒</div>
                            </button>
                            <button class="dosage-type-btn large-btn" onclick="selectDosageType('liquid')" id="type-liquid">
                                <div class="btn-icon">🥤</div>
                                <div class="btn-text">液体</div>
                            </button>
                            <button class="dosage-type-btn large-btn" onclick="selectDosageType('syrup')" id="type-syrup">
                                <div class="btn-icon">🍯</div>
                                <div class="btn-text">糖浆</div>
                            </button>
                            <button class="dosage-type-btn large-btn" onclick="selectDosageType('injection')" id="type-injection">
                                <div class="btn-icon">💉</div>
                                <div class="btn-text">注射</div>
                            </button>
                        </div>
                    </div>
                    <div class="step-footer">
                        <button class="btn-secondary" onclick="prevStep(2)">上一步</button>
                        <button class="btn-primary" onclick="nextStep(2)">下一步</button>
                    </div>
                </div>

                <!-- 步骤3: 规格/剂量 -->
                <div class="step-content" id="step-3">
                    <div class="step-header">
                        <h2 id="dosage-title">规格/剂量</h2>
                        <p class="step-subtitle" id="dosage-subtitle">请输入药品的规格或剂量</p>
                    </div>
                    <div class="step-body">
                        <input type="text" id="medicationDosage" class="form-input step-input" placeholder="如：100mg">
                    </div>
                    <div class="step-footer">
                        <button class="btn-secondary" onclick="prevStep(3)">上一步</button>
                        <button class="btn-primary" onclick="nextStep(3)">下一步</button>
                    </div>
                </div>

                <!-- 步骤4: 服用频率 -->
                <div class="step-content" id="step-4">
                    <div class="step-header">
                        <h2>服用频率</h2>
                        <p class="step-subtitle">选择每天用药次数</p>
                    </div>
                    <div class="step-body">
                        <div class="frequency-buttons" style="grid-template-columns: repeat(2, 1fr); gap: 12px;">
                            <button class="frequency-btn large-btn" onclick="selectFrequency('daily')" id="freq-daily">
                                <div class="btn-text">每日一次</div>
                            </button>
                            <button class="frequency-btn large-btn" onclick="selectFrequency('twice')" id="freq-twice">
                                <div class="btn-text">每日两次</div>
                            </button>
                            <button class="frequency-btn large-btn" onclick="selectFrequency('thrice')" id="freq-thrice">
                                <div class="btn-text">每日三次</div>
                            </button>
                            <button class="frequency-btn large-btn" onclick="selectFrequency('other')" id="freq-other">
                                <div class="btn-text">其他</div>
                            </button>
                        </div>
                    </div>
                    <div class="step-footer">
                        <button class="btn-secondary" onclick="prevStep(4)">上一步</button>
                        <button class="btn-primary" onclick="nextStep(4)">下一步</button>
                    </div>
                </div>

                <!-- 步骤5: 服用时间（动态生成） -->
                <div class="step-content" id="step-5">
                    <div class="step-header">
                        <h2 id="time-step-title">服用时间</h2>
                        <p class="step-subtitle" id="time-step-subtitle">选择用药时间</p>
                    </div>
                    <div class="step-body" id="time-inputs-container">
                        <!-- 动态生成时间输入框 -->
                    </div>
                    <div class="step-footer">
                        <button class="btn-secondary" onclick="prevStep(5)">上一步</button>
                        <button class="btn-primary" onclick="nextStep(5)">下一步</button>
                    </div>
                </div>

                <!-- 步骤6: 备注 -->
                <div class="step-content" id="step-6">
                    <div class="step-header">
                        <h2>备注（可选）</h2>
                        <p class="step-subtitle">添加额外信息</p>
                    </div>
                    <div class="step-body">
                        <textarea id="medicationNote" class="form-textarea step-textarea" placeholder="如：饭前服用，忌食辛辣" rows="6"></textarea>
                    </div>
                    <div class="step-footer">
                        <button class="btn-secondary" onclick="prevStep(6)">上一步</button>
                        <button class="btn-primary" onclick="submitMedication()">完成</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Medication Detail Panel -->
        <div class="bottom-panel-overlay" id="medicationDetailPanel" onclick="closeMedicationDetail()">
            <div class="bottom-panel" onclick="event.stopPropagation()">
                <div class="bottom-panel-header">
                    <h2 id="detail-med-name">药物详情</h2>
                    <button class="icon-btn" onclick="closeMedicationDetail()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="6" y1="6" x2="18" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="bottom-panel-content">
                    <div class="medication-detail-section">
                        <div class="detail-label">药物名称</div>
                        <div class="detail-value" id="detail-name">-</div>
                        <input type="text" class="form-input" id="edit-name" style="display: none;">
                    </div>
                    <div class="medication-detail-section">
                        <div class="detail-label">剂型</div>
                        <div class="detail-value" id="detail-type">-</div>
                        <input type="text" class="form-input" id="edit-type" style="display: none;">
                    </div>
                    <div class="medication-detail-section">
                        <div class="detail-label">规格/剂量</div>
                        <div class="detail-value" id="detail-dosage">-</div>
                        <input type="text" class="form-input" id="edit-dosage" style="display: none;">
                    </div>
                    <div class="medication-detail-section">
                        <div class="detail-label">服用频率</div>
                        <div class="detail-value" id="detail-frequency">-</div>
                        <input type="text" class="form-input" id="edit-frequency" style="display: none;">
                    </div>
                    <div class="medication-detail-section">
                        <div class="detail-label">服用时间</div>
                        <div class="detail-value" id="detail-times">-</div>
                        <input type="text" class="form-input" id="edit-times" style="display: none;">
                    </div>
                    <div class="medication-detail-section">
                        <div class="detail-label">药物用途</div>
                        <div class="detail-value" id="detail-purpose">-</div>
                        <input type="text" class="form-input" id="edit-purpose" style="display: none;">
                    </div>
                    <div class="medication-detail-section">
                        <div class="detail-label">服用说明</div>
                        <div class="detail-value" id="detail-instructions">-</div>
                        <textarea class="form-textarea" id="edit-instructions" rows="2" style="display: none;"></textarea>
                    </div>
                    <div class="medication-detail-section" id="detail-note-section" style="display: none;">
                        <div class="detail-label">备注</div>
                        <div class="detail-value" id="detail-note">-</div>
                        <textarea class="form-textarea" id="edit-note" rows="2" style="display: none;"></textarea>
                    </div>
                </div>
                <div class="bottom-panel-footer">
                    <button class="btn-secondary" style="flex: 1; background-color: var(--color-accent); color: white; border: none;" id="edit-medication-btn" onclick="editMedication(currentMedicationId)">修改信息</button>
                    <button class="btn-secondary" style="flex: 1; background-color: #dc2626; color: white; border: none;" id="delete-medication-btn" onclick="deleteMedication(currentMedicationId)">删除药物</button>
                </div>
            </div>
        </div>

        <!-- Create Case Panel (创建新病历弹窗) -->
        <div class="bottom-panel-overlay" id="createCasePanel" onclick="closeCreateCasePanel()">
            <div class="bottom-panel" onclick="event.stopPropagation()">
                <div class="bottom-panel-header">
                    <h2>创建新病历</h2>
                    <button class="icon-btn" onclick="closeCreateCasePanel()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="6" y1="6" x2="18" y2="18" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="bottom-panel-content">
                    <div class="form-group">
                        <label class="form-label">医院名称 *</label>
                        <input type="text" id="createCaseHospital" class="form-input" placeholder="请输入医院名称">
                    </div>
                    <div class="form-group">
                        <label class="form-label">科室 *</label>
                        <input type="text" id="createCaseDepartment" class="form-input" placeholder="请输入科室">
                    </div>
                    <div class="form-group">
                        <label class="form-label">症状</label>
                        <textarea id="createCaseSymptoms" class="form-textarea" rows="4" placeholder="请输入主要症状（可选）"></textarea>
                    </div>
                </div>
                <div class="bottom-panel-footer">
                    <button class="btn-secondary" onclick="closeCreateCasePanel()">取消</button>
                    <button class="btn-primary" onclick="submitCreateCase()">创建</button>
                </div>
            </div>
        </div>

        <!-- My Page -->
        <div id="page-my" class="page">
            <div class="header">
                <div class="header-content">
                    <div class="header-title">
                        <h1>我的</h1>
                        <div class="header-subtitle">个人中心</div>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="m21 21-4.35-4.35" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="section">
                    <div class="card">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div style="width: 60px; height: 60px; border-radius: 50%; background-color: var(--color-bg-tertiary); display: flex; align-items: center; justify-content: center; font-size: 32px;">
                                🍎
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 18px; font-weight: 600; color: var(--color-text-primary); margin-bottom: 4px;">张三</div>
                                <div style="font-size: 13px; color: var(--color-text-tertiary);">138****8888</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">我的健康</h2>
                    </div>
                    <div class="card-minimal" onclick="switchPage('health-data')" style="cursor: pointer;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="font-size: 20px;">📊</div>
                                <div>
                                    <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">健康数据</div>
                                    <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">查看历史数据</div>
                                </div>
                            </div>
                    </div>
                    </div>
                    <div class="card-minimal" onclick="switchPage('reminder-settings')" style="cursor: pointer;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="font-size: 20px;">🔔</div>
                                <div>
                                    <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">提醒设置</div>
                                    <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">管理通知</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">设置</h2>
                    </div>
                    <div class="card-minimal" onclick="switchPage('general-settings')" style="cursor: pointer;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="font-size: 20px;">⚙️</div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">通用设置</div>
                            </div>
                        </div>
                    </div>
                    <div class="card-minimal" onclick="switchPage('privacy-settings')" style="cursor: pointer;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="font-size: 20px;">🔒</div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">隐私安全</div>
                            </div>
                        </div>
                    </div>
                    <div class="card-minimal" onclick="switchPage('about')" style="cursor: pointer;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="font-size: 20px;">ℹ️</div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">关于</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Data Page -->
        <div id="page-health-data" class="page">
            <div class="header">
                <div class="header-content">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button class="icon-btn" onclick="switchPage('my')" style="flex-shrink: 0;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div class="header-title">
                            <h1>健康数据</h1>
                            <div class="header-subtitle">历史数据记录</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">数据概览</h2>
                    </div>
                    <div class="overview-grid">
                        <div class="overview-card">
                            <div class="overview-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="8" y1="21" x2="16" y2="21" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="12" y1="17" x2="12" y2="21" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="overview-label">血压记录</div>
                            <div class="overview-value">25</div>
                        </div>
                        <div class="overview-card">
                            <div class="overview-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 10c0 4.97-4.03 9-9 9s-9-4.03-9-9V5c0-1.66 1.34-3 3-3h12c1.66 0 3 1.34 3 3v5z" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M10 14l2 2 4-4" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="overview-label">血糖记录</div>
                            <div class="overview-value">18</div>
                        </div>
                        <div class="overview-card">
                            <div class="overview-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 6v6l4 2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="overview-label">体重记录</div>
                            <div class="overview-value">32</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">最近记录</h2>
                    </div>
                    <div class="card">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                            <div style="font-size: 15px; font-weight: 600; color: var(--color-text-primary);">血压</div>
                            <div style="font-size: 13px; color: var(--color-text-tertiary);">2025-10-20</div>
                        </div>
                        <div style="display: flex; gap: 24px;">
                            <div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-bottom: 4px;">收缩压</div>
                                <div style="font-size: 20px; font-weight: 600; color: var(--color-text-primary);">120</div>
                                <div style="font-size: 11px; color: var(--color-success);">mmHg</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-bottom: 4px;">舒张压</div>
                                <div style="font-size: 20px; font-weight: 600; color: var(--color-text-primary);">80</div>
                                <div style="font-size: 11px; color: var(--color-success);">mmHg</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                            <div style="font-size: 15px; font-weight: 600; color: var(--color-text-primary);">血糖</div>
                            <div style="font-size: 13px; color: var(--color-text-tertiary);">2025-10-20</div>
                        </div>
                        <div style="display: flex; gap: 24px;">
                            <div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-bottom: 4px;">空腹血糖</div>
                                <div style="font-size: 20px; font-weight: 600; color: var(--color-text-primary);">5.5</div>
                                <div style="font-size: 11px; color: var(--color-success);">mmol/L</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                            <div style="font-size: 15px; font-weight: 600; color: var(--color-text-primary);">体重</div>
                            <div style="font-size: 13px; color: var(--color-text-tertiary);">2025-10-20</div>
                        </div>
                        <div style="display: flex; gap: 24px;">
                            <div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-bottom: 4px;">体重</div>
                                <div style="font-size: 20px; font-weight: 600; color: var(--color-text-primary);">70</div>
                                <div style="font-size: 11px; color: var(--color-success);">kg</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reminder Settings Page -->
        <div id="page-reminder-settings" class="page">
            <div class="header">
                <div class="header-content">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button class="icon-btn" onclick="switchPage('my')" style="flex-shrink: 0;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div class="header-title">
                            <h1>提醒设置</h1>
                            <div class="header-subtitle">管理通知</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">用药提醒</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">启用用药提醒</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">每日提醒服药</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">提醒声音</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">默认提示音</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">健康提醒</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">血压测量提醒</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">每日早上8点</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">血糖测量提醒</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">每日早上7点</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- General Settings Page -->
        <div id="page-general-settings" class="page">
            <div class="header">
                <div class="header-content">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button class="icon-btn" onclick="switchPage('my')" style="flex-shrink: 0;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div class="header-title">
                            <h1>通用设置</h1>
                            <div class="header-subtitle">应用设置</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">外观</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">深色模式</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">自动跟随系统</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">字体大小</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">标准</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">数据</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">备份与恢复</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">最近备份：2025-10-20</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">数据导出</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">导出所有数据</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">其他</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">语言</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">简体中文</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Privacy Settings Page -->
        <div id="page-privacy-settings" class="page">
            <div class="header">
                <div class="header-content">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button class="icon-btn" onclick="switchPage('my')" style="flex-shrink: 0;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div class="header-title">
                            <h1>隐私安全</h1>
                            <div class="header-subtitle">数据保护</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">安全</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">面容ID解锁</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">使用面容ID保护应用</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">自动锁定</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">1分钟后</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">隐私</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">数据加密</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">本地数据已加密</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">删除所有数据</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">谨慎操作</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Page -->
        <div id="page-about" class="page">
            <div class="header">
                <div class="header-content">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button class="icon-btn" onclick="switchPage('my')" style="flex-shrink: 0;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div class="header-title">
                            <h1>关于</h1>
                            <div class="header-subtitle">应用信息</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="section">
                    <div class="card" style="text-align: center; padding: 40px 20px;">
                        <div style="width: 80px; height: 80px; border-radius: 20px; background-color: var(--color-bg-tertiary); display: flex; align-items: center; justify-content: center; font-size: 48px; margin: 0 auto 20px;">
                            🍎
                        </div>
                        <div style="font-size: 24px; font-weight: 600; color: var(--color-text-primary); margin-bottom: 8px;">健康助手</div>
                        <div style="font-size: 14px; color: var(--color-text-tertiary);">版本 1.0.0</div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">关于应用</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="font-size: 14px; line-height: 1.6; color: var(--color-text-secondary);">
                            健康助手是一款专为个人健康管理打造的应用，帮助您记录病历、管理用药、追踪健康数据，让健康管理更简单高效。
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">联系方式</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">服务邮箱</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">support@healthapp.com</div>
                            </div>
                        </div>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">客服热线</div>
                                <div style="font-size: 12px; color: var(--color-text-tertiary); margin-top: 2px;">400-123-4567</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">法律信息</h2>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">隐私政策</div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="card-minimal">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="font-size: 14px; font-weight: 500; color: var(--color-text-primary);">用户协议</div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Global Bottom Navigation -->
        <div class="bottom-nav-bar">
            <div class="bottom-nav-content">
                <button class="bottom-nav-btn" id="nav-home" onclick="switchPage('home')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="9 22 9 12 15 12 15 22" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <div class="bottom-nav-label">首页</div>
                </button>
                <button class="bottom-nav-btn" id="nav-records" onclick="switchPage('records')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 22c5.16-1.26 9-6.45 9-12V7l-9-5L2 7v3" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 22V12" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 7l10 5 10-5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <div class="bottom-nav-label">就诊记录</div>
                </button>
                <div class="bottom-nav-center-btn" onclick="openQuickAddPanel()">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="12" y1="8" x2="12" y2="16" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="8" y1="12" x2="16" y2="12" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                <button class="bottom-nav-btn" id="nav-medication" onclick="switchPage('medication')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="8" width="6" height="8" rx="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <rect x="15" y="8" width="6" height="8" rx="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M3 12h18" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    <div class="bottom-nav-label">用药</div>
                </button>
                <button class="bottom-nav-btn" id="nav-my" onclick="switchPage('my')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="7" r="4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <div class="bottom-nav-label">我的</div>
                </button>
                    </div>
            </div>
    </div>

    <script>
        // Page switching
        function switchPage(pageName) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // Show selected page
            const selectedPage = document.getElementById('page-' + pageName);
            if (selectedPage) {
                selectedPage.classList.add('active');
            }
            
            // Update bottom navigation and switch icons
            const navBtns = document.querySelectorAll('.bottom-nav-btn');
            navBtns.forEach(btn => {
                btn.classList.remove('active');
                const svg = btn.querySelector('svg');
                if (svg) {
                    // Reset to outline icon
                    svg.setAttribute('fill', 'none');
                    svg.setAttribute('stroke', 'currentColor');
                    svg.setAttribute('stroke-width', '2');
                }
            });
            
            const activeNavBtn = document.getElementById('nav-' + pageName);
            if (activeNavBtn) {
                activeNavBtn.classList.add('active');
                const svg = activeNavBtn.querySelector('svg');
                if (svg) {
                    // Switch to filled icon - remove stroke, add fill
                    svg.setAttribute('fill', 'currentColor');
                    svg.setAttribute('stroke', 'none');
                    svg.setAttribute('stroke-width', '0');
                }
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Recording functionality
        let isRecording = false;
        let recordingTime = 0;
        let recordingInterval;

        function toggleRecording() {
            const recordBtn = document.getElementById('floatingRecordBtn');
            const recordIndicator = document.getElementById('recordingIndicator');
            const recordTime = document.getElementById('recordTime');
            
            isRecording = !isRecording;
            
            if (isRecording) {
                recordBtn.classList.add('active');
                recordIndicator.classList.add('active');
                recordingTime = 0;
                
                recordingInterval = setInterval(() => {
                    recordingTime++;
                    const minutes = Math.floor(recordingTime / 60).toString().padStart(2, '0');
                    const seconds = (recordingTime % 60).toString().padStart(2, '0');
                    recordTime.textContent = `${minutes}:${seconds}`;
                }, 1000);
            } else {
                recordBtn.classList.remove('active');
                recordIndicator.classList.remove('active');
                recordTime.textContent = '00:00';
                clearInterval(recordingInterval);
            }
        }

        function startRecording() {
            // 创建新病历时的录音功能
            createNewCase();
        }

        // Pending items storage
        let pendingItems = [];

        // Add recording
        function addRecording() {
            const title = prompt('请输入录音标题（如：张医生诊断）：');
            if (title) {
                const duration = prompt('录音时长（如：5分钟）：') || '未知';
                pendingItems.push({
                    type: '录音',
                    title: title,
                    duration: duration,
                    time: new Date().toLocaleString('zh-CN')
                });
                updatePendingDisplay();
                alert('录音记录已添加到待归档');
            }
        }

        // Add report
        function addReport() {
            const title = prompt('请输入报告名称（如：血常规）：');
            if (title) {
                const type = prompt('报告类型（如：检查报告、化验单）：') || '检查报告';
                pendingItems.push({
                    type: '报告',
                    title: title,
                    reportType: type,
                    time: new Date().toLocaleString('zh-CN')
                });
                updatePendingDisplay();
                alert('检查报告已添加到待归档');
            }
        }

        // Add prescription
        function addPrescription() {
            const medicine = prompt('请输入药品名称（如：阿司匹林）：');
            if (medicine) {
                const dosage = prompt('剂量（如：100mg）：') || '';
                const times = prompt('服用频率（如：每日一次）：') || '';
                pendingItems.push({
                    type: '处方',
                    title: medicine,
                    dosage: dosage,
                    times: times,
                    time: new Date().toLocaleString('zh-CN')
                });
                updatePendingDisplay();
                alert('处方单已添加到待归档');
            }
        }

        // Add medication reminder
        function addMedicationReminder() {
            const medicine = prompt('请输入药品名称（如：阿司匹林）：');
            if (medicine) {
                const dosage = prompt('剂量（如：100mg）：') || '';
                const times = prompt('服用频率（如：每日一次）：') || '';
                alert('用药提醒已添加到用药管理页面');
                // 可以跳转到用药管理页面
                setTimeout(() => {
                    switchPage('medication');
                }, 500);
            }
        }

        // Update pending display
        function updatePendingDisplay() {
            const pendingSection = document.getElementById('pendingSection');
            const pendingContent = document.getElementById('pendingContent');
            
            if (pendingItems.length === 0) {
                pendingSection.style.display = 'none';
                return;
            }
            
            pendingSection.style.display = 'block';
            pendingContent.innerHTML = '';
            
            pendingItems.forEach((item, index) => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';
                
                let icon = '';
                let content = '';
                
                if (item.type === '录音') {
                    icon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="12" x2="12" y1="19" y2="22" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>`;
                    content = `<span>${item.title}（${item.duration}）</span>`;
                } else if (item.type === '报告') {
                    icon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="14 2 14 8 20 8" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>`;
                    content = `<span>${item.title} - ${item.reportType}</span>`;
                } else if (item.type === '处方') {
                    icon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 8h8M8 12h8M8 16h8M10 4h4v2h-4V4zM6 6v14h12V6" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>`;
                    content = `<span>${item.title} ${item.dosage} - ${item.times}</span>`;
                } else if (item.type === '病例') {
                    icon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 22V12" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 7l10 5 10-5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>`;
                    content = `<span>${item.title}</span>`;
                }
                
                itemCard.innerHTML = `
                    <div class="item-header">
                        <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                            ${icon}
                            <div>
                                <div class="item-title">${item.type}</div>
                                <div class="item-meta">${item.time}</div>
                            </div>
                        </div>
                        <div class="action-menu-container">
                            <button class="action-menu-btn" onclick="toggleActionMenu(${index})">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="1" fill="currentColor"/>
                                    <circle cx="12" cy="5" r="1" fill="currentColor"/>
                                    <circle cx="12" cy="19" r="1" fill="currentColor"/>
                                </svg>
                            </button>
                            <div class="action-menu-dropdown" id="action-menu-${index}">
                                <button class="action-menu-item" onclick="addToCase(${index})">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M12 22V12" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M2 7l10 5 10-5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    添加到病例
                                </button>
                                <button class="action-menu-item danger" onclick="deletePendingItem(${index})">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    删除
                                </button>
                            </div>
                        </div>
                    </div>
                    <div style="font-size: 13px; color: var(--color-text-secondary); margin-top: 8px;">
                        ${content}
                    </div>
                `;
                
                pendingContent.appendChild(itemCard);
            });
        }

        // Clear pending items
        function clearPending() {
            if (confirm('确定要清空所有待归档内容吗？')) {
                pendingItems = [];
                updatePendingDisplay();
            }
        }

        // Delete pending item
        function deletePendingItem(index) {
            closeAllActionMenus();
            if (confirm('确定要删除这个待归档项吗？')) {
                pendingItems.splice(index, 1);
                updatePendingDisplay();
            }
        }

        // Toggle action menu
        function toggleActionMenu(index) {
            const menu = document.getElementById(`action-menu-${index}`);
            const isActive = menu.classList.contains('active');
            
            // Close all menus first
            closeAllActionMenus();
            
            // Toggle the clicked menu
            if (!isActive) {
                menu.classList.add('active');
            }
        }

        // Close all action menus
        function closeAllActionMenus() {
            const menus = document.querySelectorAll('.action-menu-dropdown');
            menus.forEach(menu => menu.classList.remove('active'));
        }

        // Add to case
        let selectedPendingIndex = -1;

        function addToCase(index) {
            closeAllActionMenus();
            selectedPendingIndex = index;
            showCaseSelectorPanel();
        }

        function showCaseSelectorPanel() {
            const panel = document.getElementById('caseSelectorPanel');
            const list = document.getElementById('caseSelectorList');
            
            if (caseFiles.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--color-text-tertiary);">暂无病历，请先创建</div>';
            } else {
                list.innerHTML = '';
                caseFiles.forEach(caseFile => {
                    const caseItem = document.createElement('div');
                    caseItem.className = 'case-file-card';
                    caseItem.style.cursor = 'pointer';
                    caseItem.onclick = () => selectCaseForPending(caseFile.id);
                    
                    caseItem.innerHTML = `
                        <div class="case-file-header">
                            <div>
                                <div class="case-file-title">${caseFile.hospital}</div>
                                <div class="case-file-meta">${caseFile.date}</div>
                            </div>
                            <span class="tag">${caseFile.department}</span>
                        </div>
                    `;
                    
                    list.appendChild(caseItem);
                });
            }
            
            panel.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCaseSelectorPanel() {
            const panel = document.getElementById('caseSelectorPanel');
            panel.classList.remove('active');
            document.body.style.overflow = '';
            selectedPendingIndex = -1;
        }

        function selectCaseForPending(caseId) {
            if (selectedPendingIndex === -1) return;
            
            const item = pendingItems[selectedPendingIndex];
            
            // 查找对应的病例
            const targetCase = caseFiles.find(c => c.id === caseId);
            
            if (!targetCase) {
                alert('找不到该病历');
                return;
            }
            
            // 添加记录到病例
            if (!targetCase.records) {
                targetCase.records = [];
            }
            targetCase.records.push(item);
            
            // 移除待归档项
            pendingItems.splice(selectedPendingIndex, 1);
            updatePendingDisplay();
            
            alert(`已将"${item.type} - ${item.title}"添加到病历"${targetCase.hospital}"`);
            closeCaseSelectorPanel();
        }

        // Toggle quick add menu
        function toggleQuickAddMenu() {
            const menu = document.getElementById('quickAddMenu');
            menu.classList.toggle('active');
        }

        // View pending items
        function viewPending() {
            const pendingSection = document.getElementById('pendingSection');
            if (pendingItems.length === 0) {
                alert('暂无待归档内容');
                return;
            }
            pendingSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Close menus when clicking outside (merged event listener)
        document.addEventListener('click', function(event) {
            // Close action menus
            if (!event.target.closest('.action-menu-container')) {
                closeAllActionMenus();
            }
            
            // Close quick add menu
            const menu = document.getElementById('quickAddMenu');
            const centerBtn = document.querySelector('.bottom-nav-center-btn');
            if (menu && centerBtn && !menu.contains(event.target) && !centerBtn.contains(event.target)) {
                menu.classList.remove('active');
            }
        });

        // Case storage
        let caseFiles = [
            {
                id: 1,
                hospital: '北京协和医院',
                department: '心血管科',
                date: '2025-10-20 就诊',
                records: [
                    { type: '录音', title: '张医生诊断', duration: '5分钟' },
                    { type: '报告', title: '血常规、心电图', reportType: '检查报告' },
                    { type: '处方', title: '阿司匹林、降压药', dosage: '100mg', times: '每日一次' }
                ]
            },
            {
                id: 2,
                hospital: '北京大学第三医院',
                department: '内科',
                date: '2025-10-15 就诊',
                records: [
                    { type: '录音', title: '李医生咨询', duration: '8分钟' },
                    { type: '报告', title: '血常规', reportType: '检查报告' }
                ]
            },
            {
                id: 3,
                hospital: '北京朝阳医院',
                department: '骨科',
                date: '2025-10-10 就诊',
                records: [
                    { type: '报告', title: 'X光片', reportType: '影像报告' },
                    { type: '处方', title: '止痛药', dosage: '50mg', times: '每日三次' }
                ]
            }
        ];
        let caseIdCounter = 4; // Start from 4 since we have 3 existing cases

        // Case management functions
        function createNewCase() {
            // 清空表单
            document.getElementById('createCaseHospital').value = '';
            document.getElementById('createCaseDepartment').value = '';
            document.getElementById('createCaseSymptoms').value = '';
            
            // 显示弹窗
            const panel = document.getElementById('createCasePanel');
            panel.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCreateCasePanel() {
            const panel = document.getElementById('createCasePanel');
            panel.classList.remove('active');
            document.body.style.overflow = '';
        }

        function submitCreateCase() {
            const hospitalName = document.getElementById('createCaseHospital').value.trim();
            const department = document.getElementById('createCaseDepartment').value.trim();
            const symptoms = document.getElementById('createCaseSymptoms').value.trim();
            
            // 验证必填字段
            if (!hospitalName || !department) {
                alert('请填写医院名称和科室');
                return;
            }
            
            const newCase = {
                id: caseIdCounter++,
                hospital: hospitalName,
                department: department,
                date: new Date().toLocaleDateString('zh-CN'),
                records: []
            };
            
            // 如果有症状，添加为备注记录
            if (symptoms) {
                newCase.symptoms = symptoms;
            }
            
            // 如果有待归档内容，询问是否添加
            if (pendingItems.length > 0) {
                const addContent = confirm(`检测到 ${pendingItems.length} 项待归档内容，是否添加到此病历？`);
                if (addContent) {
                    pendingItems.forEach((item, index) => {
                        const include = confirm(`是否将 "${item.type} - ${item.title}" 添加到此病历？`);
                        if (include) {
                            newCase.records.push(item);
                        }
                    });
                    
                    // 移除已添加的项目
                    const addedIndices = [];
                    pendingItems.forEach((item, index) => {
                        if (newCase.records.includes(item)) {
                            addedIndices.push(index);
                        }
                    });
                    // 从后往前删除，避免索引错乱
                    addedIndices.reverse().forEach(idx => pendingItems.splice(idx, 1));
                    updatePendingDisplay();
                }
            }
            
            // 添加到病历列表
            caseFiles.push(newCase);
            
            // 动态添加到页面
            addCaseToPage(newCase);
            
            // 关闭弹窗
            closeCreateCasePanel();
            
            alert(`已创建 "${hospitalName}" 的病历${newCase.records.length > 0 ? '\n包含 ' + newCase.records.length + ' 项内容' : ''}`);
        }

        // Add case to page dynamically
        function addCaseToPage(caseData) {
            const section = document.querySelector('#page-records .section:last-of-type');
            if (!section) return;
            
            const caseCard = document.createElement('div');
            caseCard.className = 'case-file-card';
            caseCard.onclick = () => viewCaseDetail(caseData.id);
            
            let recordsHTML = '';
            if (caseData.records.length > 0) {
                recordsHTML = '<div class="case-content-section">';
                caseData.records.forEach(record => {
                    let icon = '';
                    let content = '';
                    
                    if (record.type === '录音') {
                        icon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="12" x2="12" y1="19" y2="22" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>`;
                        content = `<span>录音记录 - ${record.title}（${record.duration}）</span>`;
                    } else if (record.type === '报告') {
                        icon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-linecap="round" stroke-linejoin="round"/>
                            <polyline points="14 2 14 8 20 8" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>`;
                        content = `<span>检查报告 - ${record.title}</span>`;
                    } else if (record.type === '处方') {
                        icon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M8 8h8M8 12h8M8 16h8M10 4h4v2h-4V4zM6 6v14h12V6" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>`;
                        content = `<span>处方单 - ${record.title} ${record.dosage} - ${record.times}</span>`;
                    }
                    
                    recordsHTML += `<div class="case-content-item">${icon}${content}</div>`;
                });
                recordsHTML += '</div>';
            }
            
            caseCard.innerHTML = `
                <div class="case-file-header">
                    <div>
                        <div class="case-file-title">${caseData.hospital}</div>
                        <div class="case-file-meta">${caseData.date} 就诊</div>
                    </div>
                    <span class="tag">${caseData.department}</span>
                </div>
                ${recordsHTML}
            `;
            
            // 插入到第一个位置
            const firstCase = section.querySelector('.case-file-card');
            if (firstCase) {
                section.insertBefore(caseCard, firstCase);
            } else {
                section.appendChild(caseCard);
            }
        }

        function viewCaseDetail(caseId) {
            const staticCases = {
                1: {
                    hospital: '北京协和医院',
                    department: '心血管科',
                    date: '2025-10-20',
                    records: [
                        { type: '录音', title: '张医生诊断', duration: '5分钟' },
                        { type: '报告', title: '血常规', status: '正常' },
                        { type: '报告', title: '心电图', status: '异常' },
                        { type: '处方', title: '阿司匹林 100mg', times: '每日一次' },
                        { type: '处方', title: '降压药 5mg', times: '每日一次' }
                    ]
                },
                2: {
                    hospital: '北京大学第三医院',
                    department: '内科',
                    date: '2025-10-15',
                    records: [
                        { type: '录音', title: '李医生咨询', duration: '8分钟' },
                        { type: '报告', title: '血常规', status: '正常' }
                    ]
                },
                3: {
                    hospital: '北京朝阳医院',
                    department: '骨科',
                    date: '2025-10-10',
                    records: [
                        { type: '报告', title: 'X光片', status: '正常' },
                        { type: '处方', title: '止痛药', times: '每日三次' }
                    ]
                }
            };

            // 查找动态创建的病历
            const dynamicCase = caseFiles.find(c => c.id === caseId);
            const caseData = dynamicCase || staticCases[caseId];
            
            if (caseData) {
                // 跳转到详情页面
                switchPage('case-detail');
                
                // 处理日期格式（移除"就诊"后缀）
                const dateValue = caseData.date ? caseData.date.replace(' 就诊', '') : '';
                
                // 更新详情页面标题
                document.getElementById('detail-hospital-name').textContent = caseData.hospital;
                document.getElementById('detail-department').textContent = caseData.department;
                
                // 更新可编辑字段
                document.getElementById('edit-hospital-name').value = caseData.hospital;
                document.getElementById('edit-department').value = caseData.department;
                document.getElementById('edit-date').value = dateValue;
                
                // 保存当前病例ID
                window.currentCaseId = caseId;
                window.currentCaseData = caseData;
            }
        }

        // 病例编辑功能
        let isEditingCase = false;

        function toggleEditCase() {
            isEditingCase = !isEditingCase;
            
            const hospitalInput = document.getElementById('edit-hospital-name');
            const departmentInput = document.getElementById('edit-department');
            const dateInput = document.getElementById('edit-date');
            const editBtn = document.getElementById('edit-case-btn');
            const saveBtn = document.getElementById('save-case-btn');
            
            if (isEditingCase) {
                // 进入编辑模式
                hospitalInput.removeAttribute('readonly');
                departmentInput.removeAttribute('readonly');
                dateInput.removeAttribute('readonly');
                
                // 显示保存按钮，隐藏编辑按钮
                editBtn.style.display = 'none';
                saveBtn.style.display = 'flex';
                
                // 添加编辑样式
                hospitalInput.style.backgroundColor = 'var(--color-bg)';
                departmentInput.style.backgroundColor = 'var(--color-bg)';
                dateInput.style.backgroundColor = 'var(--color-bg)';
            } else {
                // 退出编辑模式
                hospitalInput.setAttribute('readonly', 'readonly');
                departmentInput.setAttribute('readonly', 'readonly');
                dateInput.setAttribute('readonly', 'readonly');
                
                // 显示编辑按钮，隐藏保存按钮
                editBtn.style.display = 'flex';
                saveBtn.style.display = 'none';
                
                // 移除编辑样式
                hospitalInput.style.backgroundColor = 'var(--color-bg-secondary)';
                departmentInput.style.backgroundColor = 'var(--color-bg-secondary)';
                dateInput.style.backgroundColor = 'var(--color-bg-secondary)';
            }
        }

        function saveCaseChanges() {
            const hospitalName = document.getElementById('edit-hospital-name').value.trim();
            const department = document.getElementById('edit-department').value.trim();
            const date = document.getElementById('edit-date').value.trim();
            
            if (!hospitalName || !department) {
                alert('请填写医院名称和科室');
                return;
            }
            
            // 更新病例数据
            if (window.currentCaseId) {
                // 尝试更新动态病例
                const caseData = caseFiles.find(c => c.id === window.currentCaseId);
                if (caseData) {
                    caseData.hospital = hospitalName;
                    caseData.department = department;
                    caseData.date = date + ' 就诊';
                } else {
                    // 更新静态病例数据（通过全局变量）
                    if (window.currentCaseData) {
                        window.currentCaseData.hospital = hospitalName;
                        window.currentCaseData.department = department;
                        window.currentCaseData.date = date;
                    }
                }
            }
            
            // 更新页面标题
            document.getElementById('detail-hospital-name').textContent = hospitalName;
            document.getElementById('detail-department').textContent = department;
            
            // 更新病例列表
            updateCaseInList(window.currentCaseId, hospitalName, department, date);
            
            // 退出编辑模式
            toggleEditCase();
            
            alert('病例信息已保存');
        }

        function updateCaseInList(caseId, hospitalName, department, date) {
            // 更新病历列表中的病例卡片
            const caseCards = document.querySelectorAll('.case-file-card');
            const dateDisplay = date.includes('就诊') ? date : date + ' 就诊';
            
            caseCards.forEach(card => {
                const titleElement = card.querySelector('.case-file-title');
                if (titleElement && titleElement.textContent === hospitalName) {
                    // 更新标题
                    titleElement.textContent = hospitalName;
                    
                    // 更新科室标签
                    const tagElement = card.querySelector('.tag');
                    if (tagElement) {
                        tagElement.textContent = department;
                    }
                    
                    // 更新日期
                    const metaElement = card.querySelector('.case-file-meta');
                    if (metaElement) {
                        metaElement.textContent = dateDisplay;
                    }
                }
            });
        }

        // Audio control
        let audioPlaying = false;
        function toggleAudio(audioId) {
            audioPlaying = !audioPlaying;
            const icon = document.getElementById('audio-icon-1');
            if (audioPlaying) {
                icon.innerHTML = '<rect x="6" y="4" width="4" height="16" stroke-linecap="round" stroke-linejoin="round"/><rect x="14" y="4" width="4" height="16" stroke-linecap="round" stroke-linejoin="round"/>';
                // 这里可以添加实际的音频播放逻辑
            } else {
                icon.innerHTML = '<polygon points="5 3 19 12 5 21 5 3" stroke-linecap="round" stroke-linejoin="round"/>';
            }
        }

        // Image preview
        function previewImage(src) {
            alert('图片预览功能：' + src);
            // 这里可以添加实际的图片预览逻辑
        }

        // AI Chat functions
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            const messagesDiv = document.getElementById('chatMessages');
            
            // 添加用户消息
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message user';
            userMsg.textContent = message;
            messagesDiv.appendChild(userMsg);
            
            // 清空输入框
            input.value = '';
            
            // 滚动到底部
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // 模拟AI回复
            setTimeout(() => {
                const aiMsg = document.createElement('div');
                aiMsg.className = 'chat-message ai';
                aiMsg.textContent = getAIResponse(message);
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 500);
        }

        function getAIResponse(question) {
            const responses = {
                '血常规': '根据您的血常规检查结果，各项指标均在正常范围内，包括白细胞、红细胞、血小板等。这表明您的血液系统功能正常，整体健康状况良好。',
                '心电图': '心电图显示轻微ST段改变，这是需要关注的信号。建议定期复查，平时注意休息，避免过度劳累和情绪激动。如果出现胸闷、心悸等症状应及时就医。',
                '用药': '处方中的阿司匹林用于抗血小板聚集，可预防心血管事件；降压药用于控制血压。两个药物搭配使用是标准的心血管疾病预防和治疗方案。请按时服药，不要自行停药。',
                '阿司匹林': '阿司匹林肠溶片是一种抗血小板药物，主要用于预防心肌梗死、脑梗死等心血管事件。您需要每日一次，每次1片（100mg），最好在饭后服用以减少胃肠道刺激。',
                '降压药': '降压药用于控制血压，每日一次，每次1片（5mg）。服药期间需要定期监测血压，确保血压控制在正常范围内。同时配合低盐饮食和适度运动效果更好。',
                '注意事项': '根据您的检查结果和用药情况，建议：1. 按时服药，不要漏服；2. 定期监测血压；3. 3个月后复查血常规和心电图；4. 保持规律作息，适度运动；5. 如有不适及时就医。'
            };
            
            for (let key in responses) {
                if (question.includes(key)) {
                    return responses[key];
                }
            }
            
            return '根据您的报告和处方，这个问题可以参考以下信息：检查指标总体正常，心电图有轻微异常需注意，处方用药合理。如需更详细的解答，请具体说明您想了解的内容。';
        }

        // Medication toggle
        const medicationStates = {
            1: false,
            2: true,
            3: false
        };

        // Medication database - stores full information
        const medicationDatabase = {
            1: {
                name: '阿司匹林',
                type: '片剂',
                dosage: '100mg',
                frequency: '每日一次',
                times: ['09:00'],
                purpose: '抗血小板聚集，预防心血管事件',
                instructions: '饭后服用，每日一次，每次1片',
                note: ''
            },
            2: {
                name: '维生素D',
                type: '片剂',
                dosage: '1000IU',
                frequency: '每日一次',
                times: ['14:00'],
                purpose: '补充维生素D，促进钙吸收',
                instructions: '随餐服用，每日一次，每次1片',
                note: ''
            },
            3: {
                name: '降压药',
                type: '片剂',
                dosage: '5mg',
                frequency: '每日一次',
                times: ['20:00'],
                purpose: '降低血压，控制高血压',
                instructions: '睡前服用，每日一次，每次1片',
                note: ''
            }
        };

        function toggleMedication(id) {
            medicationStates[id] = !medicationStates[id];
            
            // 更新用药管理页面的状态
            const checkbox = document.getElementById('med-' + id);
            const name = document.getElementById('med-name-' + id);
            const status = document.getElementById('med-status-' + id);
            
            // 更新首页的状态
            const homeCheckbox = document.getElementById('home-checkbox-' + id);
            const homeMedName = document.getElementById('home-med-name-' + id);
            const homeStatus = document.getElementById('home-status-' + id);
            
            if (medicationStates[id]) {
                // 用药管理页面
                if (checkbox) checkbox.classList.add('checked');
                if (name) name.classList.add('completed');
                if (status) {
                    status.textContent = '已服用';
                    status.classList.add('completed');
                }
                
                // 首页卡片
                if (homeCheckbox) {
                    homeCheckbox.classList.add('checked');
                }
                if (homeMedName) {
                    homeMedName.style.textDecoration = 'line-through';
                    homeMedName.style.color = 'var(--color-text-tertiary)';
                }
                if (homeStatus) {
                    homeStatus.textContent = '已服用';
                    homeStatus.style.color = 'var(--color-success)';
                }
            } else {
                // 用药管理页面
                if (checkbox) checkbox.classList.remove('checked');
                if (name) name.classList.remove('completed');
                if (status) {
                    status.textContent = '待服用';
                    status.classList.remove('completed');
                }
                
                // 首页卡片
                if (homeCheckbox) {
                    homeCheckbox.classList.remove('checked');
                }
                if (homeMedName) {
                    homeMedName.style.textDecoration = 'none';
                    homeMedName.style.color = 'var(--color-text-primary)';
                }
                if (homeStatus) {
                    homeStatus.textContent = '待服用';
                    homeStatus.style.color = 'var(--color-text-tertiary)';
                }
            }
        }

        // Toggle medication from home page
        function toggleHomeMedication(id, event) {
            event.stopPropagation(); // 防止触发卡片的其他点击事件
            
            // 找到对应的卡片并隐藏
            const checkbox = document.getElementById('home-checkbox-' + id);
            const card = checkbox.closest('.card-minimal');
            
            if (card) {
                // 添加动画效果后移除
                card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                card.style.opacity = '0';
                card.style.transform = 'translateX(20px)';
                
                setTimeout(() => {
                    card.style.display = 'none';
                }, 300);
            }
            
            // 更新状态
            medicationStates[id] = true;
        }

        let currentMedicationId = null; // 存储当前查看的药物ID
        
        function showMedicationDetail(id) {
            const medication = medicationDatabase[id];
            if (!medication) return;
            
            // 保存当前药物ID
            currentMedicationId = id;
            
            // 填充详情数据
            document.getElementById('detail-med-name').textContent = medication.name;
            document.getElementById('detail-name').textContent = medication.name;
            document.getElementById('detail-type').textContent = medication.type;
            document.getElementById('detail-dosage').textContent = medication.dosage;
            document.getElementById('detail-frequency').textContent = medication.frequency;
            document.getElementById('detail-times').textContent = medication.times.join('、');
            document.getElementById('detail-purpose').textContent = medication.purpose;
            document.getElementById('detail-instructions').textContent = medication.instructions;
            
            // 如果有备注，显示备注部分
            if (medication.note) {
                document.getElementById('detail-note').textContent = medication.note;
                document.getElementById('detail-note-section').style.display = 'block';
            } else {
                document.getElementById('detail-note-section').style.display = 'none';
            }
            
            // 显示面板
            const panel = document.getElementById('medicationDetailPanel');
            panel.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeMedicationDetail() {
            const panel = document.getElementById('medicationDetailPanel');
            panel.classList.remove('active');
            document.body.style.overflow = '';
            currentMedicationId = null;
            // 确保退出编辑模式并重置界面
            if (isEditMode) {
                isEditMode = false;
                // 隐藏所有编辑输入框
                document.querySelectorAll('.form-input, .form-textarea').forEach(el => el.style.display = 'none');
                // 显示所有详情
                document.querySelectorAll('.detail-value').forEach(el => el.style.display = 'block');
                // 恢复按钮
                const editBtn = document.getElementById('edit-medication-btn');
                const deleteBtn = document.getElementById('delete-medication-btn');
                editBtn.textContent = '修改信息';
                deleteBtn.textContent = '删除药物';
                deleteBtn.style.backgroundColor = '#dc2626';
            }
        }

        let isEditMode = false;

        function editMedication(id) {
            if (!id) return;
            
            isEditMode = true;
            
            // 隐藏所有详情显示
            document.querySelectorAll('.detail-value').forEach(el => el.style.display = 'none');
            
            // 显示所有编辑输入框
            document.getElementById('edit-name').style.display = 'block';
            document.getElementById('edit-type').style.display = 'block';
            document.getElementById('edit-dosage').style.display = 'block';
            document.getElementById('edit-frequency').style.display = 'block';
            document.getElementById('edit-times').style.display = 'block';
            document.getElementById('edit-purpose').style.display = 'block';
            document.getElementById('edit-instructions').style.display = 'block';
            
            // 获取当前药物信息
            const medication = medicationDatabase[id];
            if (!medication) return;
            
            // 填充输入框
            document.getElementById('edit-name').value = medication.name;
            document.getElementById('edit-type').value = medication.type;
            document.getElementById('edit-dosage').value = medication.dosage;
            document.getElementById('edit-frequency').value = medication.frequency;
            document.getElementById('edit-times').value = medication.times.join('、');
            document.getElementById('edit-purpose').value = medication.purpose;
            document.getElementById('edit-instructions').value = medication.instructions;
            
            // 如果有备注，显示备注编辑框
            if (medication.note) {
                document.getElementById('detail-note-section').style.display = 'block';
                document.getElementById('edit-note').style.display = 'block';
                document.getElementById('edit-note').value = medication.note;
            }
            
            // 修改底部按钮
            const editBtn = document.getElementById('edit-medication-btn');
            const deleteBtn = document.getElementById('delete-medication-btn');
            editBtn.textContent = '保存修改';
            editBtn.onclick = () => saveMedication(id);
            deleteBtn.textContent = '取消';
            deleteBtn.style.backgroundColor = 'var(--color-text-tertiary)';
            deleteBtn.onclick = cancelEdit;
        }

        function saveMedication(id) {
            const medication = medicationDatabase[id];
            if (!medication) return;
            
            // 获取编辑后的值
            const name = document.getElementById('edit-name').value.trim();
            const type = document.getElementById('edit-type').value.trim();
            const dosage = document.getElementById('edit-dosage').value.trim();
            const frequency = document.getElementById('edit-frequency').value.trim();
            const times = document.getElementById('edit-times').value.trim().split('、');
            const purpose = document.getElementById('edit-purpose').value.trim();
            const instructions = document.getElementById('edit-instructions').value.trim();
            const note = document.getElementById('edit-note').value.trim();
            
            // 验证必填项
            if (!name || !type || !dosage || !frequency || !times || !purpose || !instructions) {
                alert('请填写所有必填项');
                return;
            }
            
            // 更新数据库
            medication.name = name;
            medication.type = type;
            medication.dosage = dosage;
            medication.frequency = frequency;
            medication.times = times;
            medication.purpose = purpose;
            medication.instructions = instructions;
            medication.note = note;
            
            // 更新显示
            showMedicationDetail(id);
            
            // 退出编辑模式
            isEditMode = false;
            
            // 恢复按钮
            const editBtn = document.getElementById('edit-medication-btn');
            const deleteBtn = document.getElementById('delete-medication-btn');
            editBtn.textContent = '修改信息';
            editBtn.onclick = () => editMedication(id);
            deleteBtn.textContent = '删除药物';
            deleteBtn.style.backgroundColor = '#dc2626';
            deleteBtn.onclick = () => deleteMedication(id);
            
            // 隐藏编辑输入框
            document.querySelectorAll('.form-input, .form-textarea').forEach(el => el.style.display = 'none');
            
            // 显示详情
            document.querySelectorAll('.detail-value').forEach(el => el.style.display = 'block');
            
            alert('药物信息已保存');
        }

        function cancelEdit() {
            if (!isEditMode) return;
            
            isEditMode = false;
            
            // 隐藏所有编辑输入框
            document.querySelectorAll('.form-input, .form-textarea').forEach(el => el.style.display = 'none');
            
            // 显示所有详情
            document.querySelectorAll('.detail-value').forEach(el => el.style.display = 'block');
            
            // 恢复按钮
            const editBtn = document.getElementById('edit-medication-btn');
            const deleteBtn = document.getElementById('delete-medication-btn');
            editBtn.textContent = '修改信息';
            editBtn.onclick = () => editMedication(currentMedicationId);
            deleteBtn.textContent = '删除药物';
            deleteBtn.style.backgroundColor = '#dc2626';
            deleteBtn.onclick = () => deleteMedication(currentMedicationId);
        }

        // Swipe to delete functionality
        let swipingMedication = null;
        let startX = 0;
        let currentX = 0;
        let isSwipeOpen = false;
        let hasMoved = false;

        function initSwipeToDelete() {
            const medicationItems = document.querySelectorAll('.medication-item');
            
            medicationItems.forEach(item => {
                // Touch events
                item.addEventListener('touchstart', handleTouchStart, { passive: true });
                item.addEventListener('touchmove', handleTouchMove, { passive: true });
                item.addEventListener('touchend', handleTouchEnd);
                
                // Mouse events for desktop
                item.addEventListener('mousedown', handleMouseDown);
                item.addEventListener('mousemove', handleMouseMove);
                item.addEventListener('mouseup', handleMouseUp);
                item.addEventListener('mouseleave', handleMouseUp);
                
                // 添加点击事件来切换服用状态
                item.addEventListener('click', (e) => {
                    if (!isSwipeOpen && !e.target.closest('.medication-name')) {
                        const medId = item.getAttribute('data-med-id');
                        if (medId) {
                            toggleMedication(parseInt(medId));
                        }
                    }
                });
            });
            
            // 为药物名称添加点击事件显示详情
            const medicationNames = document.querySelectorAll('.medication-name');
            medicationNames.forEach(nameEl => {
                nameEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const medId = nameEl.closest('.medication-item')?.getAttribute('data-med-id');
                    if (medId) {
                        showMedicationDetail(parseInt(medId));
                    }
                });
            });
        }

        function handleTouchStart(e) {
            const item = e.currentTarget;
            if (swipingMedication && swipingMedication !== item) {
                resetSwipe();
            }
            swipingMedication = item;
            startX = e.touches[0].clientX;
            hasMoved = false;
            item.classList.add('swiping');
        }

        function handleTouchMove(e) {
            if (!swipingMedication) return;
            currentX = e.touches[0].clientX;
            const diff = currentX - startX;
            
            if (Math.abs(diff) > 5) {
                hasMoved = true;
            }
            
            if (diff < 0) {
                swipingMedication.style.transform = `translateX(${diff}px)`;
            }
        }

        function handleTouchEnd(e) {
            if (!swipingMedication) return;
            const diff = currentX - startX;
            
            if (diff < -50 && hasMoved) {
                // Swipe left - show delete button
                swipingMedication.style.transform = 'translateX(-80px)';
                isSwipeOpen = true;
            } else {
                // Swipe back
                resetSwipe();
            }
            
            swipingMedication.classList.remove('swiping');
            swipingMedication = null;
            hasMoved = false;
        }

        function handleMouseDown(e) {
            const item = e.currentTarget;
            if (swipingMedication && swipingMedication !== item) {
                resetSwipe();
            }
            swipingMedication = item;
            startX = e.clientX;
            hasMoved = false;
            item.classList.add('swiping');
        }

        function handleMouseMove(e) {
            if (!swipingMedication) return;
            currentX = e.clientX;
            const diff = currentX - startX;
            
            if (Math.abs(diff) > 5) {
                hasMoved = true;
            }
            
            if (diff < 0) {
                swipingMedication.style.transform = `translateX(${diff}px)`;
            }
        }

        function handleMouseUp(e) {
            if (!swipingMedication) return;
            const diff = currentX - startX;
            
            if (diff < -50 && hasMoved) {
                swipingMedication.style.transform = 'translateX(-80px)';
                isSwipeOpen = true;
            } else {
                resetSwipe();
            }
            
            swipingMedication.classList.remove('swiping');
            swipingMedication = null;
            hasMoved = false;
        }

        function resetSwipe() {
            if (swipingMedication) {
                swipingMedication.style.transform = 'translateX(0)';
                isSwipeOpen = false;
                swipingMedication = null;
                hasMoved = false;
            }
        }

        function deleteMedication(id) {
            if (confirm('确定要删除这个药物吗？')) {
                // 删除medication页面的药物项（med-list-item）
                const listItem = document.getElementById('med-list-' + id);
                if (listItem) {
                    listItem.style.transform = 'translateX(-100%)';
                    listItem.style.opacity = '0';
                    setTimeout(() => {
                        listItem.remove();
                    }, 300);
                }
                
                // 删除首页的药物项
                const homeCard = document.getElementById('home-card-' + id);
                if (homeCard) {
                    homeCard.style.transform = 'translateX(-100%)';
                    homeCard.style.opacity = '0';
                    setTimeout(() => {
                        homeCard.remove();
                    }, 300);
                }
                
                // 删除数据
                delete medicationStates[id];
                delete medicationDatabase[id];
                
                // 关闭详情面板
                closeMedicationDetail();
            }
        }

        // Initialize swipe on page load
        document.addEventListener('DOMContentLoaded', () => {
            initSwipeToDelete();
            
            // 点击其他地方时关闭打开的滑动状态
            document.addEventListener('click', (e) => {
                if (isSwipeOpen && swipingMedication && !e.target.closest('.medication-item-wrapper')) {
                    resetSwipe();
                }
            });
        });

        // Add Medication Panel
        let selectedTimes = []; // 存储多个时间
        let selectedFrequency = '';
        let selectedDosageType = ''; // 剂型
        let currentStep = 1;
        const totalSteps = 6;

        function openAddMedicationPanel() {
            const overlay = document.getElementById('addMedicationOverlay');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            // 重置到第一步
            currentStep = 1;
            showStep(1);
        }

        function closeAddMedicationPanel() {
            const overlay = document.getElementById('addMedicationOverlay');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
            // 重置表单
            resetMedicationForm();
        }

        function resetMedicationForm() {
            document.getElementById('medicationName').value = '';
            document.getElementById('medicationDosage').value = '';
            document.getElementById('medicationNote').value = '';
            selectedTimes = [];
            selectedFrequency = '';
            selectedDosageType = '';
            currentStep = 1;
            
            // 重置按钮状态
            document.querySelectorAll('.frequency-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.dosage-type-btn').forEach(btn => btn.classList.remove('active'));
            
            // 清空时间输入容器
            const container = document.getElementById('time-inputs-container');
            if (container) {
                container.innerHTML = '';
            }
            
            // 重置步骤
            showStep(1);
        }

        function showStep(step) {
            // 隐藏所有步骤
            for (let i = 1; i <= totalSteps; i++) {
                const stepContent = document.getElementById(`step-${i}`);
                stepContent.classList.remove('active');
            }
            
            // 显示当前步骤
            const currentStepContent = document.getElementById(`step-${step}`);
            currentStepContent.classList.add('active');
            
            // 更新进度条
            const progress = (step / totalSteps) * 100;
            document.getElementById('medicationProgressBar').style.width = progress + '%';
            
            // 更新步骤指示器
            for (let i = 1; i <= totalSteps; i++) {
                const indicator = document.getElementById(`step-${i}-indicator`);
                indicator.classList.remove('active', 'completed');
                
                if (i < step) {
                    indicator.classList.add('completed');
                } else if (i === step) {
                    indicator.classList.add('active');
                }
            }
            
            currentStep = step;
        }

        function nextStep(step) {
            // 验证当前步骤
            if (step === 1) {
                const name = document.getElementById('medicationName').value.trim();
                if (!name) {
                    alert('请输入药品名称');
                    return;
                }
            } else if (step === 2) {
                if (!selectedDosageType) {
                    alert('请选择剂型');
                    return;
                }
                // 更新剂量输入框的placeholder
                updateDosagePlaceholder();
            } else if (step === 3) {
                const dosage = document.getElementById('medicationDosage').value.trim();
                if (!dosage) {
                    alert('请输入规格/剂量');
                    return;
                }
            } else if (step === 4) {
                if (!selectedFrequency) {
                    alert('请选择服用频率');
                    return;
                }
                // 根据频率生成时间输入框
                generateTimeInputs();
            } else if (step === 5) {
                // 验证所有时间都已填写
                const allTimesFilled = selectedTimes.every(time => time);
                if (!allTimesFilled || selectedTimes.length === 0) {
                    alert('请填写所有服用时间');
                    return;
                }
            }
            
            // 移动到下一步
            if (step < totalSteps) {
                showStep(step + 1);
            }
        }

        function prevStep(step) {
            if (step > 1) {
                showStep(step - 1);
            }
        }

        function selectDosageType(type) {
            selectedDosageType = type;
            document.querySelectorAll('.dosage-type-btn').forEach(btn => btn.classList.remove('active'));
            const selectedBtn = document.getElementById('type-' + type);
            if (selectedBtn) {
                selectedBtn.classList.add('active');
            }
        }

        function updateDosagePlaceholder() {
            const dosageInput = document.getElementById('medicationDosage');
            const dosageTitle = document.getElementById('dosage-title');
            const dosageSubtitle = document.getElementById('dosage-subtitle');
            
            const typeMap = {
                'tablet': { placeholder: '如：100mg/片', title: '规格/剂量', subtitle: '请输入每片的规格（如100mg）' },
                'capsule': { placeholder: '如：250mg/粒', title: '规格/剂量', subtitle: '请输入每粒的规格（如250mg）' },
                'granule': { placeholder: '如：5g/包', title: '规格/剂量', subtitle: '请输入每包的规格（如5g）' },
                'liquid': { placeholder: '如：100ml', title: '规格/剂量', subtitle: '请输入规格（如100ml）' },
                'syrup': { placeholder: '如：100ml', title: '规格/剂量', subtitle: '请输入规格（如100ml）' },
                'injection': { placeholder: '如：10mg/ml', title: '规格/剂量', subtitle: '请输入规格（如10mg/ml）' }
            };
            
            const config = typeMap[selectedDosageType] || { placeholder: '如：100mg', title: '规格/剂量', subtitle: '请输入药品的规格或剂量' };
            
            if (dosageInput) {
                dosageInput.placeholder = config.placeholder;
            }
            if (dosageTitle) {
                dosageTitle.textContent = config.title;
            }
            if (dosageSubtitle) {
                dosageSubtitle.textContent = config.subtitle;
            }
        }

        function selectFrequency(freq) {
            selectedFrequency = freq;
            document.querySelectorAll('.frequency-btn').forEach(btn => btn.classList.remove('active'));
            const selectedBtn = document.getElementById('freq-' + freq);
            if (selectedBtn) {
                selectedBtn.classList.add('active');
            }
        }

        function generateTimeInputs() {
            const container = document.getElementById('time-inputs-container');
            const titleElement = document.getElementById('time-step-title');
            const subtitleElement = document.getElementById('time-step-subtitle');
            
            if (!container) return;
            
            container.innerHTML = '';
            selectedTimes = [];
            
            let timeCount = 0;
            let timeLabels = [];
            
            if (selectedFrequency === 'daily') {
                timeCount = 1;
                timeLabels = ['服用时间'];
            } else if (selectedFrequency === 'twice') {
                timeCount = 2;
                timeLabels = ['第一次', '第二次'];
            } else if (selectedFrequency === 'thrice') {
                timeCount = 3;
                timeLabels = ['第一次', '第二次', '第三次'];
            } else {
                timeCount = 1;
                timeLabels = ['服用时间'];
            }
            
            // 更新标题
            if (titleElement) {
                titleElement.textContent = `服用时间（${timeCount}次）`;
            }
            if (subtitleElement) {
                subtitleElement.textContent = `请为每次用药选择时间`;
            }
            
            // 生成时间输入框
            for (let i = 0; i < timeCount; i++) {
                selectedTimes.push('');
                
                const timeGroup = document.createElement('div');
                timeGroup.className = 'time-input-group';
                
                const label = document.createElement('label');
                label.textContent = timeLabels[i];
                
                const input = document.createElement('input');
                input.type = 'time';
                input.dataset.index = i;
                input.onchange = function() {
                    selectedTimes[i] = this.value;
                };
                
                timeGroup.appendChild(label);
                timeGroup.appendChild(input);
                container.appendChild(timeGroup);
            }
        }

        function openCameraForMedicine() {
            // 触发文件选择或相机
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.capture = 'environment'; // 使用后置摄像头
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    // 读取图片
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = e.target.result;
                        
                        // 模拟OCR识别（实际应该调用OCR API）
                        alert('正在识别药品信息...\n\n（演示模式：模拟识别中）');
                        
                        // 模拟识别结果
                        setTimeout(() => {
                            const recognizedName = '阿司匹林肠溶片'; // 模拟识别结果
                            const recognizedDosage = '100mg'; // 模拟识别结果
                            
                            document.getElementById('medicationName').value = recognizedName;
                            document.getElementById('medicationDosage').value = recognizedDosage;
                            
                            alert('识别成功！\n\n药品名称：' + recognizedName + '\n规格：' + recognizedDosage);
                        }, 1000);
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            input.click();
        }

        function submitMedication() {
            const name = document.getElementById('medicationName').value.trim();
            const dosage = document.getElementById('medicationDosage').value.trim();
            const note = document.getElementById('medicationNote').value.trim();
            
            // 验证必填项
            if (!name || !dosage || !selectedDosageType || !selectedFrequency || selectedTimes.length === 0) {
                alert('请填写所有必填项');
                return;
            }
            
            // 验证所有时间都已填写
            const allTimesFilled = selectedTimes.every(time => time);
            if (!allTimesFilled) {
                alert('请填写所有服用时间');
                return;
            }
            
            // 格式化时间显示
            const timeDisplay = selectedTimes.join('、');
            
            // 获取剂型显示文本
            const typeMap = {
                'tablet': '片剂',
                'capsule': '胶囊',
                'granule': '颗粒',
                'liquid': '液体',
                'syrup': '糖浆',
                'injection': '注射'
            };
            const typeDisplay = typeMap[selectedDosageType] || '';
            
            // 获取频率显示文本
            const freqMap = {
                'daily': '每日一次',
                'twice': '每日两次',
                'thrice': '每日三次',
                'other': '其他'
            };
            const freqDisplay = freqMap[selectedFrequency];
            
            // 创建药物提醒
            alert(`已添加药物提醒：\n\n药品名称：${name}\n剂型：${typeDisplay}\n规格/剂量：${dosage}\n服用时间：${timeDisplay}\n服用频率：${freqDisplay}\n备注：${note || '无'}`);
            
            // 这里可以添加实际的数据保存逻辑
            // 例如将药物添加到列表中
            const firstTime = selectedTimes[0];
            
            // 生成药物用途和服用说明（可以根据药名查询数据库）
            const purpose = getMedicationPurpose(name);
            const instructions = getMedicationInstructions(name, freqDisplay, typeDisplay);
            
            addMedicationToList(name, typeDisplay, dosage, firstTime, freqDisplay, selectedTimes, purpose, instructions, note);
            
            // 关闭面板
            closeAddMedicationPanel();
        }

        function getMedicationPurpose(name) {
            // 根据药物名称生成用途（实际应用中应该查询药物数据库）
            const purposeMap = {
                '阿司匹林': '抗血小板聚集，预防心血管事件',
                '维生素D': '补充维生素D，促进钙吸收',
                '降压药': '降低血压，控制高血压'
            };
            
            for (let key in purposeMap) {
                if (name.includes(key)) {
                    return purposeMap[key];
                }
            }
            
            return '请遵医嘱服用';
        }

        function getMedicationInstructions(name, frequency, type) {
            // 根据药物信息生成服用说明
            const instructions = `每日${frequency.replace('每日', '')}，每次1${type.includes('片') ? '片' : type.includes('粒') ? '粒' : type.includes('包') ? '包' : 'ml'}`;
            return instructions;
        }

        function addMedicationToList(name, type, dosage, time, frequency, times, purpose, instructions, note) {
            // 动态添加药物到列表
            const todaySection = document.querySelector('#page-medication .section:first-of-type');
            if (!todaySection) return;
            
            // 创建新的药物项
            const newId = Date.now();
            
            // 创建med-list-item（列表样式，无checkbox）
            const listItem = document.createElement('div');
            listItem.className = 'med-list-item';
            listItem.id = `med-list-${newId}`;
            listItem.onclick = () => showMedicationDetail(newId);
            
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <div class="med-list-name" id="med-list-name-${newId}">${name}</div>
                        <div class="med-list-info">${time} · ${dosage}</div>
                    </div>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="12 6 12 12 16 14" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            `;
            
            // 查找第一个med-list-item，将新项插入到它之前
            const firstListItem = todaySection.querySelector('.med-list-item');
            if (firstListItem) {
                todaySection.insertBefore(listItem, firstListItem);
            } else {
                // 如果没有现有药物，添加到section-header后面
                const sectionHeader = todaySection.querySelector('.section-header');
                if (sectionHeader && sectionHeader.nextSibling) {
                    todaySection.insertBefore(listItem, sectionHeader.nextSibling);
                } else {
                    todaySection.appendChild(listItem);
                }
            }
            
            // 同时添加到首页
            addMedicationToHome(newId, name, dosage, time);
            
            // 更新状态
            medicationStates[newId] = false;
            
            // 存储到药物数据库
            medicationDatabase[newId] = {
                name: name,
                type: type,
                dosage: dosage,
                frequency: frequency,
                times: times,
                purpose: purpose,
                instructions: instructions,
                note: note
            };
        }
        
        // 添加药物到首页
        function addMedicationToHome(id, name, dosage, time) {
            const homeSection = document.querySelector('#page-home .section:nth-child(2)');
            if (!homeSection) return;
            
            const homeCard = document.createElement('div');
            homeCard.className = 'card-minimal';
            homeCard.style.cursor = 'pointer';
            homeCard.id = `home-card-${id}`;
            
            homeCard.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                        <div class="home-checkbox" id="home-checkbox-${id}" onclick="toggleHomeMedication(${id}, event)"></div>
                        <div style="flex: 1;">
                            <div style="font-size: 16px; font-weight: 500; color: var(--color-text-primary);" id="home-med-name-${id}">${name}</div>
                            <div style="font-size: 13px; color: var(--color-text-tertiary); margin-top: 4px;">${dosage}</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 15px; color: var(--color-text-primary); margin-bottom: 4px;">${time}</div>
                        <div style="font-size: 12px; color: var(--color-text-tertiary);" id="home-status-${id}">待服用</div>
                    </div>
                </div>
            `;
            
            // 添加到今日用药区域的最后
            homeSection.appendChild(homeCard);
        }

        // ============= 添加页面功能函数 =============
        
        // 打开快速添加面板
        function openQuickAddPanel() {
            const panel = document.getElementById('quickAddPanel');
            panel.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // 关闭快速添加面板
        function closeQuickAddPanel() {
            const panel = document.getElementById('quickAddPanel');
            panel.classList.remove('active');
            document.body.style.overflow = '';
        }

        // 录音相关变量
        let isRecordingAudio = false;
        let audioRecordingTime = 0;
        let audioRecordingInterval = null;
        let recordedDuration = '';

        // 录音记录面板
        function showRecordingPanel() {
            closeQuickAddPanel();
            const panel = document.getElementById('recordingPanel');
            panel.classList.add('active');
            document.body.style.overflow = 'hidden';
            // 重置录音状态
            resetRecordingState();
        }

        function closeRecordingPanel() {
            const panel = document.getElementById('recordingPanel');
            panel.classList.remove('active');
            document.body.style.overflow = '';
            // 重置表单和录音状态
            document.getElementById('recordingTitle').value = '';
            resetRecordingState();
        }

        function resetRecordingState() {
            isRecordingAudio = false;
            audioRecordingTime = 0;
            recordedDuration = '';
            if (audioRecordingInterval) {
                clearInterval(audioRecordingInterval);
                audioRecordingInterval = null;
            }
            const recordBtn = document.getElementById('recordBtn');
            const recordTime = document.getElementById('recordTime');
            recordBtn.classList.remove('recording');
            recordTime.textContent = '00:00';
            recordTime.style.color = 'var(--color-text-primary)';
        }

        function toggleRecordAudio() {
            isRecordingAudio = !isRecordingAudio;
            const recordBtn = document.getElementById('recordBtn');
            const recordTime = document.getElementById('recordTime');

            if (isRecordingAudio) {
                // 开始录音
                recordBtn.classList.add('recording');
                audioRecordingTime = 0;
                recordTime.style.color = '#dc2626';
                
                audioRecordingInterval = setInterval(() => {
                    audioRecordingTime++;
                    const minutes = Math.floor(audioRecordingTime / 60).toString().padStart(2, '0');
                    const seconds = (audioRecordingTime % 60).toString().padStart(2, '0');
                    recordTime.textContent = `${minutes}:${seconds}`;
                }, 1000);
            } else {
                // 停止录音
                recordBtn.classList.remove('recording');
                const minutes = Math.floor(audioRecordingTime / 60).toString().padStart(2, '0');
                const seconds = (audioRecordingTime % 60).toString().padStart(2, '0');
                recordedDuration = `${minutes}:${seconds}`;
                recordTime.style.color = 'var(--color-text-primary)';
                
                if (audioRecordingInterval) {
                    clearInterval(audioRecordingInterval);
                    audioRecordingInterval = null;
                }
            }
        }

        function submitRecording() {
            const title = document.getElementById('recordingTitle').value.trim();

            if (!title) {
                alert('请填写录音标题');
                return;
            }

            if (!recordedDuration) {
                alert('请先录音');
                return;
            }

            // 添加到待归档
            pendingItems.push({
                type: '录音',
                title: title,
                duration: recordedDuration,
                time: new Date().toLocaleString('zh-CN')
            });
            updatePendingDisplay();

            alert('录音记录已添加到待归档');
            closeRecordingPanel();
        }

        // 报告面板
        let selectedReportType = '';
        let reportImageData = null;

        function showReportPanel() {
            closeQuickAddPanel();
            const panel = document.getElementById('reportPanel');
            panel.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeReportPanel() {
            const panel = document.getElementById('reportPanel');
            panel.classList.remove('active');
            document.body.style.overflow = '';
            // 重置表单
            reportImageData = null;
            // 重置上传区域
            resetReportImageUpload();
        }

        function uploadReportImage() {
            document.getElementById('reportImageInput').click();
        }

        function handleReportImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    reportImageData = e.target.result;
                    displayReportImage(reportImageData);
                };
                reader.readAsDataURL(file);
            }
        }

        function displayReportImage(imageData) {
            const container = document.getElementById('reportImageContainer');
            container.innerHTML = `
                <img src="${imageData}" class="uploaded-image" alt="报告照片">
                <button class="btn-secondary" onclick="resetReportImageUpload()" style="width: 100%; margin-bottom: 16px;">重新上传</button>
            `;
        }

        function resetReportImageUpload() {
            const container = document.getElementById('reportImageContainer');
            container.innerHTML = `
                <div class="upload-image-btn" onclick="uploadReportImage()">
                    <input type="file" id="reportImageInput" accept="image/*" style="display: none;" onchange="handleReportImageUpload(event)">
                    <div class="upload-image-icon">📷</div>
                    <div class="upload-image-text">点击上传报告照片</div>
                    <div class="upload-image-desc">支持拍照或从相册选择</div>
                </div>
            `;
            reportImageData = null;
        }

        function selectReportType(type) {
            selectedReportType = type;
            document.querySelectorAll('.frequency-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function submitReport() {
            if (!reportImageData) {
                alert('请上传报告照片');
                return;
            }

            // 添加到待归档
            pendingItems.push({
                type: '报告',
                title: '检查报告',
                imageData: reportImageData,
                time: new Date().toLocaleString('zh-CN')
            });
            updatePendingDisplay();

            alert('检查报告已添加到待归档');
            closeReportPanel();
        }

        // 用药提醒面板（复用现有的用药面板）
        function showMedicationPanel() {
            closeQuickAddPanel();
            openAddMedicationPanel();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('健康助手应用已加载');
            // Set initial active nav and icon
            const homeBtn = document.getElementById('nav-home');
            homeBtn.classList.add('active');
            const homeSvg = homeBtn.querySelector('svg');
            if (homeSvg) {
                // Set home icon to filled
                homeSvg.setAttribute('fill', 'currentColor');
                homeSvg.setAttribute('stroke', 'none');
                homeSvg.setAttribute('stroke-width', '0');
            }
        });
    </script>
</body>
</html>
</html>
</html>
</html>
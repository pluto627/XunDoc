# 新功能使用指南

## 功能概述

本次更新实现了两个主要功能计划：

### 计划一：对话历史与管理面板功能 ✅

**核心改进：**
- ✅ 将原有的sheet弹窗改为左侧滑入的侧边栏设计
- ✅ 更新按钮图标为汉堡菜单（三条横线）
- ✅ 优化交互体验，添加平滑动画效果
- ✅ 保留所有原有功能：新建对话、切换对话、删除对话

**使用方式：**
1. 在AI咨询界面，点击左上角的汉堡菜单图标（三条横线）
2. 侧边栏从左侧滑入，显示所有对话历史
3. 点击"新建对话"按钮可创建新的对话会话
4. 点击任一历史对话可切换到该对话
5. 每个对话卡片上都有删除按钮，可快速删除不需要的对话
6. 点击侧边栏外部区域或关闭按钮可关闭侧边栏

**视觉特性：**
- 当前选中的对话会有蓝色边框和背景高亮
- 显示对话标题、消息预览、时间和消息数量
- 侧边栏打开时，主内容区域会变暗以突出侧边栏

---

### 计划二：多样化医疗通知系统 ✅

**核心功能：**
- ✅ 多种通知类型支持
- ✅ 智能通知调度
- ✅ 完整的通知管理界面
- ✅ 本地推送通知集成
- ✅ 在主页显示今日提醒

#### 1. 通知类型

系统支持以下6种医疗通知类型：

| 类型 | 图标 | 说明 | 颜色 |
|------|------|------|------|
| **药物提醒** | 💊 | 按时服药提醒，可设置剂量和用法 | 蓝色 |
| **复查提醒** | 🔄 | 定期复查项目提醒 | 橙色 |
| **预约提醒** | 📅 | 门诊预约、就诊提醒 | 紫色 |
| **健康检查** | ❤️ | 年度/季度体检提醒 | 绿色 |
| **症状追踪** | 📊 | 日常症状记录提醒 | 粉色 |
| **疫苗接种** | 💉 | 疫苗接种时间提醒 | 青色 |

#### 2. 通知模板

系统为每种类型预设了专业的通知模板：

**药物提醒模板：**
```
您好，[患者姓名]。提醒您按时服用 [药品名称]，[剂量与用法]。请遵医嘱。
```

**复查提醒模板：**
```
温馨提示：您预约的 [复查项目] 将于 [日期] 进行，请提前做好准备，
按时前往 [医院/科室]。
```

**预约提醒模板：**
```
提醒您，您与 [医生姓名] 医生的门诊预约安排在 [日期] [时间]，
地点：[医院] [科室]，请不要忘记。
```

**健康检查提醒模板：**
```
您好，[患者姓名]。您的[检查类型]时间快到了，建议您近期安排一次
全面的身体检查，关注自身健康。
```

**疫苗接种提醒模板：**
```
[患者姓名]，提醒您 [日期] 前往 [接种地点] 接种 [疫苗名称]。
请携带相关证件，注意接种前后事项。
```

#### 3. 主要功能特性

**通知管理：**
- 创建、编辑、删除通知
- 启用/禁用通知
- 标记完成
- 查看历史记录

**智能筛选：**
- 全部通知
- 今天的提醒
- 即将到来（未来7天）
- 已过期
- 已完成
- 按类型筛选

**通知调度：**
- 定时推送本地通知
- 支持重复提醒（每天、每周、每月等）
- 自动重新调度重复提醒
- 优先级管理（普通、正常、重要、紧急）

**统计信息：**
- 总通知数
- 活跃通知数
- 已完成通知数
- 过期通知数
- 今日提醒数
- 即将到来的提醒数

#### 4. 使用指南

**在主页查看今日提醒：**
1. 打开应用首页
2. 滚动到"今日提醒"卡片
3. 查看今天所有待办的医疗提醒
4. 点击右侧的勾选按钮可快速标记完成
5. 如有过期提醒，会在标题右侧显示红色徽章

**添加新提醒：**
1. 在主页点击"查看全部"打开通知管理页面
2. 点击右上角的菜单按钮，选择"添加提醒"
3. 选择通知类型（药物、复查、预约等）
4. 填写标题和详细消息
5. 设置提醒时间
6. 选择是否重复及重复频率
7. 设置优先级
8. 点击"保存"

**管理通知：**
1. 在通知列表中，点击任一通知卡片上的省略号图标
2. 可选择：
   - 编辑：修改通知详情
   - 启用/禁用：临时关闭或开启提醒
   - 删除：永久删除该提醒

**快速完成提醒：**
- 在通知卡片上点击绿色勾选图标
- 对于重复提醒，完成后会自动创建下一次提醒

**清理历史：**
1. 点击右上角菜单
2. 选择"清除已完成"
3. 系统会删除所有已完成的通知

#### 5. 通知权限

**首次使用时：**
- 应用会自动请求通知权限
- 请在系统弹窗中点击"允许"
- 允许后才能接收定时推送通知

**如果没有收到通知：**
1. 打开 设置 > XunDoc
2. 确保"通知"已开启
3. 确保"横幅"、"声音"、"标记"都已启用
4. 返回应用重新尝试

#### 6. 最佳实践

**药物提醒：**
- 建议设置为每天重复
- 将时间设置为固定的服药时间
- 在备注中记录药物注意事项

**复查提醒：**
- 提前1-2天设置提醒
- 在消息中包含具体的检查项目
- 记录医院和科室信息

**预约提醒：**
- 提前2-3小时设置提醒
- 包含医生姓名和就诊位置
- 标记为"重要"或"紧急"优先级

**健康检查：**
- 设置为每年重复
- 提前一周提醒
- 在备注中记录上次检查结果

---

## 技术实现细节

### 新增文件

1. **Models/MedicalNotification.swift**
   - 通知数据模型
   - 通知类型枚举
   - 优先级定义
   - 重复间隔配置
   - 预设模板方法

2. **Managers/MedicalNotificationManager.swift**
   - 通知管理器
   - 本地通知调度
   - 数据持久化
   - 权限管理
   - 统计功能

3. **Views/MedicalNotificationsView.swift**
   - 完整的通知管理界面
   - 筛选功能
   - 添加/编辑界面
   - 通知卡片组件

### 修改文件

1. **Views/ChatConsultationView.swift**
   - 添加侧边栏组件
   - 更新按钮为汉堡菜单
   - 实现滑入动画效果

2. **Views/HomeView.swift**
   - 添加医疗通知卡片
   - 显示今日提醒
   - 快速完成功能

3. **ContentView.swift**
   - 集成通知管理器
   - 环境对象配置
   - 通知权限请求

4. **XunDocApp.swift**
   - 添加AppDelegate
   - 实现通知代理
   - 处理前台通知显示

---

## 数据存储

所有通知数据都存储在UserDefaults中，支持：
- 自动保存
- 自动加载
- 跨应用重启持久化

建议定期清理已完成的历史通知以优化性能。

---

## 故障排查

### 通知没有显示

**问题：** 设置了提醒但没有收到通知

**解决方案：**
1. 检查系统设置中的通知权限
2. 确保应用在后台运行或允许后台刷新
3. 检查"勿扰模式"是否开启
4. 重启应用并重新授权通知权限

### 侧边栏不滑出

**问题：** 点击汉堡菜单没有反应

**解决方案：**
1. 确保使用的是最新版本的代码
2. 检查是否有编译错误
3. 重新构建项目

### 通知时间不准确

**问题：** 通知提前或延迟触发

**解决方案：**
1. 检查设备时间设置是否正确
2. iOS系统会智能调度通知，可能有轻微延迟
3. 重新设置通知时间

---

## 未来改进方向

1. **云同步**：支持多设备数据同步
2. **智能提醒**：基于用户习惯的智能提醒时间建议
3. **语音输入**：快速创建提醒
4. **提醒分组**：按治疗计划分组管理
5. **数据导出**：导出提醒记录为PDF或Excel

---

## 支持与反馈

如有任何问题或建议，欢迎通过以下方式联系：
- 项目问题跟踪
- 用户反馈表单
- 技术支持邮箱

---

**版本：** 1.0.0  
**更新日期：** 2025年10月10日  
**开发者：** XunDoc Team


# XunDoc iOS è‡ªåŠ¨åŒ–æµ‹è¯•ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«å®Œæ•´çš„iOS UIè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ŒåŸºäºAppleå®˜æ–¹çš„XCUITestæ¡†æ¶å¼€å‘ï¼Œå¯ä»¥è‡ªåŠ¨æµ‹è¯•åº”ç”¨çš„ä¸»è¦åŠŸèƒ½ã€‚

---

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### âœ… å·²å®ç°çš„è‡ªåŠ¨åŒ–æµ‹è¯• (10ä¸ªæµ‹è¯•ç”¨ä¾‹)

| æµ‹è¯•ç¼–å· | æµ‹è¯•åç§° | æµ‹è¯•å†…å®¹ | ä¼˜å…ˆçº§ |
|---------|---------|---------|-------|
| TC-AUTO-001 | åº”ç”¨å¯åŠ¨æµ‹è¯• | éªŒè¯åº”ç”¨æ­£å¸¸å¯åŠ¨å’Œä¸»é¡µåŠ è½½ | P0 |
| TC-AUTO-002 | åº•éƒ¨å¯¼èˆªæµ‹è¯• | æµ‹è¯•4ä¸ªTabé¡µé¢åˆ‡æ¢ | P0 |
| TC-AUTO-003 | åˆ›å»ºè®°å½•æµ‹è¯• | è‡ªåŠ¨åˆ›å»ºå°±è¯Šè®°å½• | P0 |
| TC-AUTO-004 | æœç´¢åŠŸèƒ½æµ‹è¯• | æµ‹è¯•è®°å½•æœç´¢åŠŸèƒ½ | P1 |
| TC-AUTO-005 | æŸ¥çœ‹è¯¦æƒ…æµ‹è¯• | æµ‹è¯•ç—…å†è¯¦æƒ…é¡µé¢ | P1 |
| TC-AUTO-006 | æ·»åŠ ç”¨è¯æµ‹è¯• | è‡ªåŠ¨æ·»åŠ ç”¨è¯æé†’ | P0 |
| TC-AUTO-007 | å®Œæˆç”¨è¯æµ‹è¯• | æµ‹è¯•æ ‡è®°ç”¨è¯å®Œæˆ | P1 |
| TC-AUTO-008 | ä¸ªäººé¡µé¢æµ‹è¯• | æµ‹è¯•ä¸ªäººé¡µé¢åŠŸèƒ½å…¥å£ | P1 |
| TC-AUTO-009 | æ€§èƒ½æµ‹è¯• | æµ‹è¯•é¡µé¢åˆ‡æ¢æ€§èƒ½ | P1 |
| TC-AUTO-010 | ç¨³å®šæ€§æµ‹è¯• | å¿«é€Ÿæ“ä½œå‹åŠ›æµ‹è¯• | P1 |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šåœ¨Xcodeä¸­è¿è¡Œæµ‹è¯•

#### 1. æ‰“å¼€é¡¹ç›®
```bash
cd /Users/plutoguo/Desktop/XunDoc
open XunDoc.xcodeproj
```

#### 2. è¿è¡Œå•ä¸ªæµ‹è¯•
1. åœ¨Xcodeä¸­æŒ‰ `Cmd + 6` æ‰“å¼€æµ‹è¯•å¯¼èˆªå™¨
2. æ‰¾åˆ° `XunDocUITests` > `XunDocAutomatedTests`
3. ç‚¹å‡»ä»»ä¸€æµ‹è¯•æ–¹æ³•æ—è¾¹çš„ â–¶ï¸ æŒ‰é’®è¿è¡Œ

#### 3. è¿è¡Œæ‰€æœ‰æµ‹è¯•
1. é€‰æ‹©æµ‹è¯•ç±» `XunDocAutomatedTests`
2. ç‚¹å‡»ç±»åæ—è¾¹çš„ â–¶ï¸ æŒ‰é’®
3. æˆ–ä½¿ç”¨å¿«æ·é”® `Cmd + U` è¿è¡Œæ‰€æœ‰æµ‹è¯•

#### 4. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
è¿è¡Œ `testCompleteTestSuite()` æ–¹æ³•ï¼Œå°†æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰10ä¸ªæµ‹è¯•ç”¨ä¾‹

---

### æ–¹æ³•äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œæµ‹è¯•

#### è¿è¡Œæ‰€æœ‰UIæµ‹è¯•
```bash
cd /Users/plutoguo/Desktop/XunDoc

# åœ¨æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œ
xcodebuild test \
  -project XunDoc.xcodeproj \
  -scheme XunDoc \
  -destination 'platform=iOS Simulator,name=iPhone 15 Pro,OS=17.0' \
  -only-testing:XunDocUITests
```

#### è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# åªè¿è¡Œåº”ç”¨å¯åŠ¨æµ‹è¯•
xcodebuild test \
  -project XunDoc.xcodeproj \
  -scheme XunDoc \
  -destination 'platform=iOS Simulator,name=iPhone 15 Pro,OS=17.0' \
  -only-testing:XunDocUITests/XunDocAutomatedTests/test001_AppLaunch
```

#### ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”ŸæˆHTMLæŠ¥å‘Š
xcodebuild test \
  -project XunDoc.xcodeproj \
  -scheme XunDoc \
  -destination 'platform=iOS Simulator,name=iPhone 15 Pro,OS=17.0' \
  -only-testing:XunDocUITests \
  -resultBundlePath TestResults.xcresult

# æŸ¥çœ‹ç»“æœ
open TestResults.xcresult
```

---

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨Fastlaneè‡ªåŠ¨åŒ–ï¼ˆæ¨èï¼‰

#### 1. å®‰è£…Fastlane
```bash
# ä½¿ç”¨Homebrewå®‰è£…
brew install fastlane

# æˆ–ä½¿ç”¨RubyGems
sudo gem install fastlane
```

#### 2. åˆ›å»ºFastfile
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `fastlane/Fastfile`:

```ruby
# fastlane/Fastfile

default_platform(:ios)

platform :ios do
  
  # è¿è¡ŒUIè‡ªåŠ¨åŒ–æµ‹è¯•
  desc "è¿è¡ŒUIè‡ªåŠ¨åŒ–æµ‹è¯•"
  lane :ui_test do
    run_tests(
      scheme: "XunDoc",
      devices: ["iPhone 15 Pro", "iPhone SE (3rd generation)"],
      clean: true,
      code_coverage: true,
      output_directory: "./test_output",
      output_types: "html,junit"
    )
  end
  
  # å¿«é€Ÿæµ‹è¯•ï¼ˆä»…æ ¸å¿ƒåŠŸèƒ½ï¼‰
  desc "å¿«é€Ÿæµ‹è¯•æ ¸å¿ƒåŠŸèƒ½"
  lane :quick_test do
    run_tests(
      scheme: "XunDoc",
      devices: ["iPhone 15 Pro"],
      only_testing: [
        "XunDocUITests/XunDocAutomatedTests/test001_AppLaunch",
        "XunDocUITests/XunDocAutomatedTests/test002_TabBarNavigation",
        "XunDocUITests/XunDocAutomatedTests/test003_CreateHealthRecord"
      ]
    )
  end
  
  # å®Œæ•´æµ‹è¯•å¥—ä»¶
  desc "è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶"
  lane :full_test do
    run_tests(
      scheme: "XunDoc",
      devices: ["iPhone 15 Pro", "iPhone 14", "iPhone SE (3rd generation)"],
      clean: true,
      code_coverage: true,
      result_bundle: true,
      output_directory: "./test_output",
      output_types: "html,junit,json"
    )
    
    # ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
    sh("echo 'æµ‹è¯•å®Œæˆï¼æŸ¥çœ‹æŠ¥å‘Š: ./test_output/report.html'")
  end
  
  # å¤œé—´å›å½’æµ‹è¯•
  desc "å¤œé—´å›å½’æµ‹è¯•"
  lane :nightly do
    # æ¸…ç†
    clean_build_artifacts
    
    # è¿è¡Œæµ‹è¯•
    full_test
    
    # å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
    notification(
      title: "XunDoc æµ‹è¯•å®Œæˆ",
      message: "å¤œé—´å›å½’æµ‹è¯•å·²å®Œæˆï¼Œè¯·æŸ¥çœ‹æŠ¥å‘Š"
    )
  end
end
```

#### 3. è¿è¡ŒFastlaneæµ‹è¯•
```bash
# è¿è¡ŒUIæµ‹è¯•
fastlane ui_test

# å¿«é€Ÿæµ‹è¯•
fastlane quick_test

# å®Œæ•´æµ‹è¯•
fastlane full_test

# å¤œé—´æµ‹è¯•
fastlane nightly
```

---

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### æŸ¥çœ‹æµ‹è¯•ç»“æœ

#### 1. Xcodeä¸­æŸ¥çœ‹
- æµ‹è¯•å®Œæˆåï¼Œç‚¹å‡» Xcode å³ä¾§çš„ "Report Navigator" (Cmd + 9)
- é€‰æ‹©æœ€æ–°çš„æµ‹è¯•è¿è¡Œè®°å½•
- æŸ¥çœ‹è¯¦ç»†çš„æµ‹è¯•ç»“æœã€æˆªå›¾å’Œæ—¥å¿—

#### 2. å‘½ä»¤è¡ŒæŸ¥çœ‹
```bash
# æŸ¥çœ‹.xcresultæ–‡ä»¶
xcrun xcresulttool get --path TestResults.xcresult
```

#### 3. HTMLæŠ¥å‘Š
ä½¿ç”¨Fastlaneè¿è¡Œæµ‹è¯•ä¼šè‡ªåŠ¨ç”ŸæˆHTMLæŠ¥å‘Šï¼š
```bash
open ./test_output/report.html
```

### æµ‹è¯•æŠ¥å‘ŠåŒ…å«å†…å®¹
- âœ… é€šè¿‡çš„æµ‹è¯•æ•°é‡
- âŒ å¤±è´¥çš„æµ‹è¯•æ•°é‡
- â±ï¸ æ¯ä¸ªæµ‹è¯•çš„æ‰§è¡Œæ—¶é—´
- ğŸ“¸ å¤±è´¥æ—¶çš„è‡ªåŠ¨æˆªå›¾
- ğŸ“ è¯¦ç»†çš„æµ‹è¯•æ—¥å¿—
- ğŸ“ˆ æµ‹è¯•é€šè¿‡ç‡ç»Ÿè®¡

---

## ğŸ”§ é…ç½®å’Œå®šåˆ¶

### 1. ä¿®æ”¹æµ‹è¯•è®¾å¤‡
ç¼–è¾‘æµ‹è¯•ä»£ç æˆ–Fastfileä¸­çš„è®¾å¤‡åˆ—è¡¨ï¼š
```swift
// æ”¯æŒçš„è®¾å¤‡
- iPhone SE (3rd generation)
- iPhone 14
- iPhone 15 Pro
- iPhone 15 Pro Max
- iPad Air (5th generation)
```

### 2. æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹
åœ¨ `XunDocAutomatedTests.swift` ä¸­æ·»åŠ æ–°æ–¹æ³•ï¼š
```swift
/// TC-AUTO-011: ä½ çš„æµ‹è¯•æè¿°
func test011_YourTestName() throws {
    print("ğŸ“± [æµ‹è¯•] æµ‹è¯•æè¿°")
    
    // 1. å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
    navigateToHome()
    
    // 2. æ‰§è¡Œæµ‹è¯•æ“ä½œ
    let button = app.buttons["æŒ‰é’®æ ‡è¯†"]
    XCTAssertTrue(button.exists, "æŒ‰é’®åº”è¯¥å­˜åœ¨")
    button.tap()
    
    // 3. éªŒè¯ç»“æœ
    let result = app.staticTexts["é¢„æœŸç»“æœ"]
    XCTAssertTrue(result.exists, "åº”è¯¥æ˜¾ç¤ºé¢„æœŸç»“æœ")
    
    print("âœ… [é€šè¿‡] æµ‹è¯•é€šè¿‡")
}
```

### 3. è®¾ç½®æµ‹è¯•è¶…æ—¶æ—¶é—´
```swift
// åœ¨ setUpWithError() ä¸­è®¾ç½®
executionTimeAllowance = 300 // 5åˆ†é’Ÿ
```

### 4. å¯ç”¨/ç¦ç”¨æµ‹è¯•
```swift
// ä¸´æ—¶è·³è¿‡æŸä¸ªæµ‹è¯•
func test_SkipThisTest() throws {
    throw XCTSkip("æš‚æ—¶è·³è¿‡æ­¤æµ‹è¯•")
}
```

---

## ğŸ¬ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‰å‡†å¤‡
```swift
// åœ¨æ¯ä¸ªæµ‹è¯•å‰é‡ç½®åº”ç”¨çŠ¶æ€
override func setUpWithError() throws {
    continueAfterFailure = false
    
    app = XCUIApplication()
    app.launchArguments = ["UI-Testing"]
    app.launch()
    
    // ç­‰å¾…å¯åŠ¨å®Œæˆ
    sleep(3)
}
```

### 2. ä½¿ç”¨Accessibility Identifier
åœ¨ä»£ç ä¸­è®¾ç½®ï¼š
```swift
// SwiftUI
Text("ç™»å½•")
    .accessibilityIdentifier("loginButton")

// UIKit
button.accessibilityIdentifier = "loginButton"
```

åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ï¼š
```swift
let loginButton = app.buttons["loginButton"]
loginButton.tap()
```

### 3. ç­‰å¾…å…ƒç´ å‡ºç°
```swift
// ç­‰å¾…æœ€å¤š5ç§’
let element = app.buttons["æäº¤"]
let exists = element.waitForExistence(timeout: 5)
XCTAssertTrue(exists, "æäº¤æŒ‰é’®åº”è¯¥åœ¨5ç§’å†…å‡ºç°")
```

### 4. å¤„ç†å¼‚æ­¥æ“ä½œ
```swift
// ç­‰å¾…ç½‘ç»œè¯·æ±‚å®Œæˆ
let expectation = XCTestExpectation(description: "æ•°æ®åŠ è½½")
DispatchQueue.main.asyncAfter(deadline: .now() + 2) {
    expectation.fulfill()
}
wait(for: [expectation], timeout: 5)
```

### 5. æˆªå›¾ä¿å­˜
```swift
// åœ¨å…³é”®æ­¥éª¤æˆªå›¾
private func takeScreenshot(name: String) {
    let screenshot = app.screenshot()
    let attachment = XCTAttachment(screenshot: screenshot)
    attachment.name = name
    attachment.lifetime = .keepAlways
    add(attachment)
}

// ä½¿ç”¨
takeScreenshot(name: "ç™»å½•æˆåŠŸé¡µé¢")
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ‰¾ä¸åˆ°å…ƒç´ 
**è§£å†³æ–¹æ³•**ï¼š
```swift
// 1. æ£€æŸ¥å…ƒç´ ç±»å‹
app.buttons["æŒ‰é’®"]
app.staticTexts["æ–‡æœ¬"]
app.textFields["è¾“å…¥æ¡†"]

// 2. ä½¿ç”¨æ¨¡ç³ŠåŒ¹é…
let button = app.buttons.matching(NSPredicate(format: "label CONTAINS 'ç™»å½•'")).firstMatch

// 3. æ‰“å°æ‰€æœ‰å…ƒç´ 
print(app.debugDescription)
```

### Q2: æµ‹è¯•è¿è¡Œç¼“æ…¢
**è§£å†³æ–¹æ³•**ï¼š
```swift
// 1. å‡å°‘sleepæ—¶é—´
sleep(1) // æ”¹ä¸ºæ›´çŸ­çš„ç­‰å¾…

// 2. ä½¿ç”¨waitForExistenceæ›¿ä»£sleep
element.waitForExistence(timeout: 2)

// 3. å¹¶è¡Œè¿è¡Œæµ‹è¯•
// åœ¨æµ‹è¯•æ–¹æ¡ˆä¸­å¯ç”¨ "Parallelize" é€‰é¡¹
```

### Q3: æµ‹è¯•ä¸ç¨³å®šï¼ˆFlaky Testsï¼‰
**è§£å†³æ–¹æ³•**ï¼š
```swift
// 1. å¢åŠ ç­‰å¾…æ—¶é—´
element.waitForExistence(timeout: 5)

// 2. é‡è¯•æœºåˆ¶
func tapWithRetry(_ element: XCUIElement, retries: Int = 3) {
    for i in 0..<retries {
        if element.exists && element.isHittable {
            element.tap()
            return
        }
        sleep(1)
    }
    XCTFail("æ— æ³•ç‚¹å‡»å…ƒç´ ")
}

// 3. æ£€æŸ¥å…ƒç´ æ˜¯å¦å¯äº¤äº’
if element.exists && element.isHittable {
    element.tap()
}
```

### Q4: æ¨¡æ‹Ÿå™¨ä¸å“åº”
**è§£å†³æ–¹æ³•**ï¼š
```bash
# é‡ç½®æ‰€æœ‰æ¨¡æ‹Ÿå™¨
xcrun simctl shutdown all
xcrun simctl erase all

# é‡å¯æ¨¡æ‹Ÿå™¨æœåŠ¡
sudo killall -9 com.apple.CoreSimulator.CoreSimulatorService
```

---

## ğŸ“… CI/CDé›†æˆ

### GitHub Actions
åˆ›å»º `.github/workflows/ui-tests.yml`:
```yaml
name: UI Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: macos-13
    steps:
      - uses: actions/checkout@v3
      
      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode_15.0.app
      
      - name: Run UI Tests
        run: |
          xcodebuild test \
            -project XunDoc.xcodeproj \
            -scheme XunDoc \
            -destination 'platform=iOS Simulator,name=iPhone 15 Pro,OS=17.0' \
            -only-testing:XunDocUITests
      
      - name: Upload Test Results
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: test-results
          path: TestResults.xcresult
```

---

## ğŸ“ˆ æµ‹è¯•æŒ‡æ ‡

### å»ºè®®çš„æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡
- **æ ¸å¿ƒåŠŸèƒ½**: 100% (å¯åŠ¨ã€å¯¼èˆªã€åˆ›å»ºè®°å½•ã€æ·»åŠ ç”¨è¯)
- **ä¸»è¦åŠŸèƒ½**: 80% (æœç´¢ã€è¯¦æƒ…ã€ç¼–è¾‘ã€åˆ é™¤)
- **è¾…åŠ©åŠŸèƒ½**: 60% (ç»Ÿè®¡ã€å¸®åŠ©ã€å…³äº)

### æ€§èƒ½åŸºå‡†
- åº”ç”¨å¯åŠ¨æ—¶é—´: < 3ç§’
- é¡µé¢åˆ‡æ¢: < 0.5ç§’
- åˆ—è¡¨æ»šåŠ¨: 60 FPS
- ç½‘ç»œè¯·æ±‚: < 2ç§’

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- ğŸ“§ Email: support@xundoc.com
- ğŸ“ Issues: åœ¨é¡¹ç›®ä¸­åˆ›å»ºIssue

---

**æœ€åæ›´æ–°**: 2025-10-29  
**ç‰ˆæœ¬**: v1.0.0



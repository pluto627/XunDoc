# 对话管理功能使用说明

## 功能概述

在AI健康咨询页面，我已经为您添加了完整的对话管理功能，让您可以保存、切换和管理多个对话会话。

## 主要功能

### 1. 对话目录（左上角文件夹图标）📁

- **位置**：聊天界面左上角的蓝色文件夹图标
- **功能**：点击后打开对话历史列表
- **徽章**：图标右上角显示当前保存的对话总数

### 2. 对话历史列表

点击文件夹图标后，您将看到：

#### 顶部统计区域
- 显示"对话记录"和总对话数量
- "新建"按钮：快速创建新对话

#### 对话卡片
每个对话显示为一个卡片，包含：
- **标题**：对话的第一条消息内容（自动生成）
- **当前标记**：正在使用的对话有蓝色边框和勾选标记 ✓
- **消息预览**：最后一条消息的内容
- **时间戳**：最后更新时间（相对时间）
- **消息数量**：该对话包含的消息总数
- **删除按钮**：红色垃圾桶图标，点击删除对话

#### 空状态引导
如果还没有对话：
- 显示友好的引导界面
- 提供"创建新对话"按钮

### 3. 菜单功能（右上角三点图标）

点击右上角的菜单图标，可以：
- **新对话**：创建一个全新的对话
- **清空当前对话**：删除当前对话并创建新对话（有确认提示）

## 使用流程

### 开始第一个对话
1. 打开AI健康咨询页面
2. 直接开始输入问题或上传图片
3. 对话会自动保存

### 创建新对话
方式一：
1. 点击左上角文件夹图标
2. 点击右上角"新建"按钮
3. 开始新的对话

方式二：
1. 点击右上角三点菜单
2. 选择"新对话"

### 切换对话
1. 点击左上角文件夹图标
2. 在对话列表中点击任意对话卡片
3. 自动切换到该对话并显示历史消息

### 删除对话
方式一：
1. 点击左上角文件夹图标
2. 点击对话卡片右上角的红色垃圾桶图标
3. 确认删除

方式二：
1. 点击右上角三点菜单
2. 选择"清空当前对话"（只删除当前对话）

## 自动保存功能

- ✅ 所有消息自动实时保存
- ✅ 对话标题自动生成（取第一条用户消息）
- ✅ 更新时间自动记录
- ✅ 支持图片消息保存
- ✅ 数据持久化存储，关闭应用后不会丢失

## UI特点

- 🎨 **现代卡片设计**：清晰的层次结构
- 🔵 **当前对话标识**：蓝色边框和勾选标记
- ⏰ **相对时间显示**：如"5分钟前"、"2小时前"
- 💬 **消息预览**：快速了解对话内容
- 🗑️ **一键删除**：方便的删除操作
- 📊 **统计信息**：对话数量一目了然
- 📳 **震动反馈**：所有操作都有触觉反馈

## 技术特性

- **数据持久化**：使用 UserDefaults 存储，支持 JSON 编解码
- **状态管理**：使用 ObservableObject 实时同步
- **图片压缩**：图片自动压缩到 50% 质量，节省存储
- **性能优化**：使用 LazyVStack 延迟加载，支持大量对话

## 注意事项

1. **删除不可恢复**：删除对话前会有确认提示，请谨慎操作
2. **自动创建**：首次使用时会自动创建第一个对话
3. **消息排序**：对话列表按最后更新时间倒序排列
4. **标题生成**：第一条用户消息会作为对话标题（限30字符）

## 快捷操作

- 📱 **长按删除**：对话卡片支持左滑删除（备用方案）
- 🔄 **自动切换**：切换对话后自动加载历史消息
- ⚡ **快速新建**：多种方式快速创建新对话
- 🎯 **直达功能**：文件夹图标一键打开历史

## 更新内容

相比之前的版本，本次更新：

1. ✨ **视觉优化**：从列表样式改为卡片样式
2. 🎨 **更清晰的标识**：当前对话有明显的视觉区分
3. 📊 **统计信息**：顶部显示对话总数
4. 🗑️ **更方便的删除**：卡片上直接显示删除按钮
5. 📁 **更直观的图标**：文件夹图标更符合"目录"概念
6. 🎯 **简化操作**：点击文件夹直接打开历史，无需二级菜单
7. 💡 **空状态引导**：首次使用时有友好的引导界面

---

现在您可以轻松管理多个对话，随时切换回之前的咨询历史！所有对话都会自动保存，再也不用担心重要的医疗建议丢失。

